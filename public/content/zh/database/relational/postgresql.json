{
  "slug": "postgresql",
  "meta": {
    "title": "PostgreSQL",
    "description": "PostgreSQL 高级特性、JSON 支持与扩展功能",
    "order": 2,
    "tags": [
      "PostgreSQL",
      "SQL",
      "关系型数据库"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "PostgreSQL 是功能强大的开源对象关系型数据库",
        "支持丰富数据类型：JSON、Array、范围类型",
        "强大的 SQL 支持：CTE、窗口函数",
        "高度可扩展：自定义类型、函数、索引"
      ]
    },
    {
      "type": "cards",
      "title": "特色数据类型",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "JSONB",
          "badge": "半结构化",
          "badgeColor": "blue",
          "points": [
            "二进制存储",
            "支持索引",
            "丰富操作符"
          ]
        },
        {
          "title": "Array",
          "badge": "集合",
          "badgeColor": "green",
          "points": [
            "原生数组支持",
            "ANY/ALL 查询",
            "数组函数"
          ]
        },
        {
          "title": "Range",
          "badge": "范围",
          "badgeColor": "purple",
          "points": [
            "时间/数值范围",
            "重叠检测",
            "排除约束"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "JSONB 操作",
      "language": "sql",
      "code": "-- 创建带 JSONB 的表\nCREATE TABLE products (\n    id SERIAL PRIMARY KEY,\n    name VARCHAR(100),\n    attributes JSONB\n);\n\n-- 查询 JSON 字段\nSELECT name, attributes->>'brand' as brand FROM products;\nSELECT * FROM products WHERE attributes @> '{\"brand\": \"Apple\"}';\n\n-- JSON 操作符\n->  获取对象字段 (返回 JSON)\n->> 获取对象字段 (返回文本)\n@>  包含\n?   键存在"
    },
    {
      "type": "comparison",
      "title": "索引类型",
      "columns": [
        {
          "title": "B-Tree",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            {
              "label": "用途",
              "description": "默认索引类型"
            },
            {
              "label": "适用",
              "description": "等值、范围查询"
            }
          ]
        },
        {
          "title": "GIN",
          "color": "from-green-500 to-emerald-500",
          "items": [
            {
              "label": "用途",
              "description": "倒排索引"
            },
            {
              "label": "适用",
              "description": "JSONB、全文搜索"
            }
          ]
        },
        {
          "title": "GiST",
          "color": "from-purple-500 to-pink-500",
          "items": [
            {
              "label": "用途",
              "description": "通用搜索树"
            },
            {
              "label": "适用",
              "description": "地理数据、范围"
            }
          ]
        },
        {
          "title": "BRIN",
          "color": "from-amber-500 to-orange-500",
          "items": [
            {
              "label": "用途",
              "description": "块范围索引"
            },
            {
              "label": "适用",
              "description": "时序数据"
            }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "窗口函数",
      "language": "sql",
      "code": "-- 排名函数\nSELECT name, department, salary,\n    RANK() OVER (PARTITION BY department ORDER BY salary DESC) as rank\nFROM employees;\n\n-- 累计计算\nSELECT date, amount,\n    SUM(amount) OVER (ORDER BY date) as running_total\nFROM sales;\n\n-- 前后行\nSELECT date, value,\n    LAG(value) OVER (ORDER BY date) as prev_value,\n    LEAD(value) OVER (ORDER BY date) as next_value\nFROM metrics;"
    },
    {
      "type": "codeBlock",
      "title": "递归 CTE",
      "language": "sql",
      "code": "-- 递归查询组织架构\nWITH RECURSIVE subordinates AS (\n    SELECT id, name, manager_id, 1 as level\n    FROM employees WHERE id = 1\n    UNION ALL\n    SELECT e.id, e.name, e.manager_id, s.level + 1\n    FROM employees e\n    JOIN subordinates s ON e.manager_id = s.id\n)\nSELECT * FROM subordinates;"
    },
    {
      "type": "table",
      "title": "常用扩展",
      "highlightFirst": true,
      "headers": [
        "扩展",
        "功能",
        "用途"
      ],
      "rows": [
        [
          "uuid-ossp",
          "UUID 生成",
          "分布式 ID"
        ],
        [
          "pg_trgm",
          "相似度搜索",
          "模糊匹配"
        ],
        [
          "PostGIS",
          "地理空间",
          "GIS 应用"
        ],
        [
          "pg_stat_statements",
          "查询统计",
          "性能分析"
        ]
      ]
    },
    {
      "type": "list",
      "title": "最佳实践",
      "style": "check",
      "items": [
        {
          "label": "使用 JSONB",
          "description": "比 JSON 类型性能更好，支持索引"
        },
        {
          "label": "部分索引",
          "description": "只索引常用条件的数据子集"
        },
        {
          "label": "EXPLAIN ANALYZE",
          "description": "分析实际执行计划"
        },
        {
          "label": "连接池",
          "description": "使用 PgBouncer 管理连接"
        }
      ]
    }
  ],
  "relatedTopics": [
    "MySQL",
    "JSONB",
    "全文搜索"
  ]
}