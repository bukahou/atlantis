{
  "slug": "redis",
  "meta": {
    "title": "Redis",
    "description": "Redis 内存数据库、数据结构与缓存策略",
    "order": 2,
    "tags": [
      "Redis",
      "缓存",
      "NoSQL"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "Redis 是高性能内存键值数据库",
        "支持丰富数据结构：String, Hash, List, Set, ZSet",
        "持久化：RDB 快照 + AOF 日志",
        "高可用：主从复制、哨兵、Cluster"
      ]
    },
    {
      "type": "cards",
      "title": "数据结构",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "String",
          "badge": "基础",
          "badgeColor": "blue",
          "points": [
            "SET/GET",
            "INCR/DECR",
            "EX 过期时间"
          ]
        },
        {
          "title": "Hash",
          "badge": "对象",
          "badgeColor": "green",
          "points": [
            "HSET/HGET",
            "HGETALL",
            "适合存对象"
          ]
        },
        {
          "title": "List",
          "badge": "队列",
          "badgeColor": "amber",
          "points": [
            "LPUSH/RPOP",
            "BLPOP 阻塞",
            "消息队列"
          ]
        },
        {
          "title": "Set",
          "badge": "集合",
          "badgeColor": "purple",
          "points": [
            "SADD/SMEMBERS",
            "交/并/差集",
            "去重标签"
          ]
        },
        {
          "title": "ZSet",
          "badge": "排行榜",
          "badgeColor": "red",
          "points": [
            "ZADD/ZRANGE",
            "按分数排序",
            "排行榜"
          ]
        },
        {
          "title": "Stream",
          "badge": "消息",
          "badgeColor": "cyan",
          "points": [
            "XADD/XREAD",
            "消费组",
            "持久化MQ"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "常用命令",
      "language": "bash",
      "code": "# String\nSET key value EX 3600\nGET key\nINCR counter\n\n# Hash\nHSET user:1 name \"Alice\" age 28\nHGETALL user:1\n\n# List (队列)\nLPUSH queue item1 item2\nBRPOP queue 10\n\n# Sorted Set (排行榜)\nZADD leaderboard 100 \"player1\" 200 \"player2\"\nZREVRANGE leaderboard 0 9 WITHSCORES"
    },
    {
      "type": "comparison",
      "title": "缓存问题与解决",
      "columns": [
        {
          "title": "缓存穿透",
          "color": "from-red-500 to-orange-500",
          "items": [
            {
              "label": "问题",
              "description": "查询不存在数据"
            },
            {
              "label": "解决",
              "description": "布隆过滤器/空值缓存"
            }
          ]
        },
        {
          "title": "缓存击穿",
          "color": "from-amber-500 to-yellow-500",
          "items": [
            {
              "label": "问题",
              "description": "热点 key 过期"
            },
            {
              "label": "解决",
              "description": "互斥锁/逻辑过期"
            }
          ]
        },
        {
          "title": "缓存雪崩",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            {
              "label": "问题",
              "description": "大量 key 同时过期"
            },
            {
              "label": "解决",
              "description": "过期时间加随机值"
            }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "分布式锁",
      "language": "lua",
      "code": "-- 加锁\nSET lock:resource uuid EX 30 NX\n\n-- 解锁 (Lua 脚本保证原子性)\nif redis.call(\"get\", KEYS[1]) == ARGV[1] then\n    return redis.call(\"del\", KEYS[1])\nelse\n    return 0\nend\n\n-- Redlock: 多节点获取锁，过半成功则加锁成功"
    },
    {
      "type": "table",
      "title": "持久化对比",
      "highlightFirst": true,
      "headers": [
        "方式",
        "原理",
        "优点",
        "缺点"
      ],
      "rows": [
        [
          "RDB",
          "定时快照",
          "恢复快、文件小",
          "可能丢数据"
        ],
        [
          "AOF",
          "命令日志",
          "数据安全",
          "文件大、恢复慢"
        ],
        [
          "混合",
          "RDB+AOF",
          "兼顾两者",
          "推荐使用"
        ]
      ]
    },
    {
      "type": "flow",
      "title": "集群架构",
      "direction": "horizontal",
      "steps": [
        {
          "label": "主从复制",
          "description": "读写分离",
          "color": "bg-blue-500"
        },
        {
          "label": "哨兵模式",
          "description": "自动故障转移",
          "color": "bg-purple-500"
        },
        {
          "label": "Cluster",
          "description": "分片集群",
          "color": "bg-green-500"
        }
      ]
    },
    {
      "type": "list",
      "title": "最佳实践",
      "style": "check",
      "items": [
        {
          "label": "设置过期时间",
          "description": "避免内存无限增长"
        },
        {
          "label": "使用 Pipeline",
          "description": "批量操作减少网络往返"
        },
        {
          "label": "避免大 Key",
          "description": "单 Key 不超过 10MB"
        },
        {
          "label": "Lua 脚本",
          "description": "保证复杂操作原子性"
        }
      ]
    }
  ],
  "relatedTopics": [
    "MongoDB",
    "缓存策略",
    "分布式锁"
  ]
}