{
  "slug": "tcp-ip",
  "meta": {
    "title": "TCP/IP 协议基础",
    "description": "理解网络通信的核心协议栈",
    "order": 1,
    "tags": [
      "network",
      "tcp",
      "ip",
      "protocol"
    ]
  },
  "content": "<h1>TCP/IP 协议基础</h1>\n<h2>网络分层模型</h2>\n<h3>OSI 七层 vs TCP/IP 四层</h3>\n<pre><code>OSI 模型              TCP/IP 模型           协议示例\n┌─────────────┐      ┌─────────────┐\n│   应用层    │      │             │       HTTP, FTP, DNS\n├─────────────┤      │   应用层    │       SMTP, SSH, HTTPS\n│   表示层    │      │             │\n├─────────────┤      ├─────────────┤\n│   会话层    │      │             │\n├─────────────┤      ├─────────────┤\n│   传输层    │      │   传输层    │       TCP, UDP\n├─────────────┤      ├─────────────┤\n│   网络层    │      │   网络层    │       IP, ICMP, ARP\n├─────────────┤      ├─────────────┤\n│ 数据链路层  │      │             │       Ethernet, Wi-Fi\n├─────────────┤      │  网络接口层 │\n│   物理层    │      │             │\n└─────────────┘      └─────────────┘\n</code></pre>\n<h2>IP 协议</h2>\n<h3>IPv4 地址</h3>\n<pre><code>32 位地址，点分十进制表示\n\n192.168.1.100\n\n┌────────┬────────┬────────┬────────┐\n│   192  │   168  │    1   │   100  │\n├────────┴────────┴────────┴────────┤\n│  11000000.10101000.00000001.01100100\n└───────────────────────────────────┘\n</code></pre>\n<h3>IP 地址分类</h3>\n<table>\n<thead>\n<tr>\n<th>类别</th>\n<th>范围</th>\n<th>默认掩码</th>\n<th>用途</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>A</td>\n<td>1.0.0.0 - 126.255.255.255</td>\n<td>255.0.0.0</td>\n<td>大型网络</td>\n</tr>\n<tr>\n<td>B</td>\n<td>128.0.0.0 - 191.255.255.255</td>\n<td>255.255.0.0</td>\n<td>中型网络</td>\n</tr>\n<tr>\n<td>C</td>\n<td>192.0.0.0 - 223.255.255.255</td>\n<td>255.255.255.0</td>\n<td>小型网络</td>\n</tr>\n</tbody>\n</table>\n<h3>私有地址</h3>\n<pre><code>10.0.0.0    - 10.255.255.255   (A 类)\n172.16.0.0  - 172.31.255.255   (B 类)\n192.168.0.0 - 192.168.255.255  (C 类)\n</code></pre>\n<h3>子网划分</h3>\n<pre><code class=\"language-bash\"># CIDR 表示法\n192.168.1.0/24\n\n# 子网掩码\n255.255.255.0\n\n# 计算\n网络地址: 192.168.1.0\n广播地址: 192.168.1.255\n可用主机: 192.168.1.1 - 192.168.1.254 (254 个)\n</code></pre>\n<h2>TCP 协议</h2>\n<h3>TCP 特性</h3>\n<ul>\n<li><strong>面向连接</strong>: 通信前需建立连接</li>\n<li><strong>可靠传输</strong>: 确保数据完整有序</li>\n<li><strong>流量控制</strong>: 防止发送过快</li>\n<li><strong>拥塞控制</strong>: 适应网络状况</li>\n</ul>\n<h3>三次握手</h3>\n<pre><code>客户端                         服务器\n   │                              │\n   │  ─────── SYN (seq=x) ──────> │  1. 客户端发起连接\n   │                              │\n   │  &#x3C;── SYN+ACK (seq=y,ack=x+1) │  2. 服务器确认并同步\n   │                              │\n   │  ─────── ACK (ack=y+1) ────> │  3. 客户端确认\n   │                              │\n   │        连接已建立             │\n</code></pre>\n<h3>四次挥手</h3>\n<pre><code>客户端                         服务器\n   │                              │\n   │  ─────── FIN (seq=u) ──────> │  1. 客户端请求断开\n   │                              │\n   │  &#x3C;────── ACK (ack=u+1) ───── │  2. 服务器确认\n   │                              │\n   │  &#x3C;────── FIN (seq=v) ─────── │  3. 服务器请求断开\n   │                              │\n   │  ─────── ACK (ack=v+1) ────> │  4. 客户端确认\n   │                              │\n   │        连接已关闭             │\n</code></pre>\n<h3>TCP 头部</h3>\n<pre><code> 0                   1                   2                   3\n 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n├─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┤\n│          源端口 (16 位)         │        目标端口 (16 位)       │\n├───────────────────────────────┴───────────────────────────────┤\n│                        序列号 (32 位)                          │\n├───────────────────────────────────────────────────────────────┤\n│                        确认号 (32 位)                          │\n├───────┬───────┬─┬─┬─┬─┬─┬─┬───────────────────────────────────┤\n│头长度 │ 保留  │U│A│P│R│S│F│          窗口大小 (16 位)         │\n├───────┴───────┴─┴─┴─┴─┴─┴─┴───────────────────────────────────┤\n│         校验和 (16 位)          │        紧急指针 (16 位)       │\n└───────────────────────────────┴───────────────────────────────┘\n</code></pre>\n<h3>常用端口</h3>\n<table>\n<thead>\n<tr>\n<th>端口</th>\n<th>协议</th>\n<th>服务</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>20/21</td>\n<td>TCP</td>\n<td>FTP</td>\n</tr>\n<tr>\n<td>22</td>\n<td>TCP</td>\n<td>SSH</td>\n</tr>\n<tr>\n<td>23</td>\n<td>TCP</td>\n<td>Telnet</td>\n</tr>\n<tr>\n<td>25</td>\n<td>TCP</td>\n<td>SMTP</td>\n</tr>\n<tr>\n<td>53</td>\n<td>TCP/UDP</td>\n<td>DNS</td>\n</tr>\n<tr>\n<td>80</td>\n<td>TCP</td>\n<td>HTTP</td>\n</tr>\n<tr>\n<td>443</td>\n<td>TCP</td>\n<td>HTTPS</td>\n</tr>\n<tr>\n<td>3306</td>\n<td>TCP</td>\n<td>MySQL</td>\n</tr>\n<tr>\n<td>6379</td>\n<td>TCP</td>\n<td>Redis</td>\n</tr>\n</tbody>\n</table>\n<h2>UDP 协议</h2>\n<h3>UDP vs TCP</h3>\n<table>\n<thead>\n<tr>\n<th>特性</th>\n<th>TCP</th>\n<th>UDP</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>连接</td>\n<td>面向连接</td>\n<td>无连接</td>\n</tr>\n<tr>\n<td>可靠性</td>\n<td>可靠</td>\n<td>不可靠</td>\n</tr>\n<tr>\n<td>顺序</td>\n<td>保证顺序</td>\n<td>不保证</td>\n</tr>\n<tr>\n<td>速度</td>\n<td>较慢</td>\n<td>较快</td>\n</tr>\n<tr>\n<td>用途</td>\n<td>文件传输、网页</td>\n<td>视频流、游戏</td>\n</tr>\n</tbody>\n</table>\n<h3>UDP 头部</h3>\n<pre><code> 0                   1                   2                   3\n 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n├─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┤\n│          源端口 (16 位)         │        目标端口 (16 位)       │\n├───────────────────────────────┼───────────────────────────────┤\n│           长度 (16 位)          │        校验和 (16 位)         │\n└───────────────────────────────┴───────────────────────────────┘\n</code></pre>\n<h2>网络诊断工具</h2>\n<h3>ping</h3>\n<pre><code class=\"language-bash\"># 测试连通性\nping 8.8.8.8\nping -c 4 google.com    # 发送 4 个包\n</code></pre>\n<h3>traceroute</h3>\n<pre><code class=\"language-bash\"># 追踪路由路径\ntraceroute google.com\ntracepath google.com\n</code></pre>\n<h3>netstat</h3>\n<pre><code class=\"language-bash\"># 查看网络连接\nnetstat -tuln          # TCP/UDP 监听端口\nnetstat -anp           # 所有连接及进程\n</code></pre>\n<h3>ss</h3>\n<pre><code class=\"language-bash\"># 现代 netstat 替代\nss -tuln               # 监听端口\nss -s                  # 统计信息\n</code></pre>\n<h3>tcpdump</h3>\n<pre><code class=\"language-bash\"># 抓包分析\ntcpdump -i eth0                    # 指定网卡\ntcpdump -i eth0 port 80            # 指定端口\ntcpdump -i eth0 host 192.168.1.1   # 指定主机\ntcpdump -w capture.pcap            # 保存到文件\n</code></pre>\n<h3>curl</h3>\n<pre><code class=\"language-bash\"># HTTP 请求测试\ncurl http://example.com\ncurl -I http://example.com         # 仅头部\ncurl -X POST -d \"data\" http://api  # POST 请求\n</code></pre>\n<h2>总结</h2>\n<p>TCP/IP 是互联网的基础：</p>\n<ol>\n<li><strong>IP</strong> 负责寻址和路由</li>\n<li><strong>TCP</strong> 提供可靠的端到端传输</li>\n<li><strong>UDP</strong> 提供快速但不可靠的传输</li>\n<li>理解分层模型有助于排查网络问题</li>\n</ol>\n<p>掌握常用诊断工具，能快速定位网络故障。</p>\n"
}