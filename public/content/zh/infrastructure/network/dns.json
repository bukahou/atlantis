{
  "slug": "dns",
  "meta": {
    "title": "DNS 域名系统",
    "description": "理解域名解析原理与 DNS 配置",
    "order": 2,
    "tags": [
      "network",
      "dns",
      "domain"
    ]
  },
  "content": "<h1>DNS 域名系统</h1>\n<h2>什么是 DNS</h2>\n<p>DNS (Domain Name System) 是互联网的\"电话簿\"，将人类可读的域名转换为机器可读的 IP 地址。</p>\n<pre><code>用户输入: www.example.com\n    ↓ DNS 解析\n返回 IP: 93.184.216.34\n</code></pre>\n<h2>DNS 层级结构</h2>\n<pre><code>                    根域名 (.)\n                        │\n        ┌───────────────┼───────────────┐\n        │               │               │\n      .com            .org            .cn\n        │               │               │\n    ┌───┴───┐       ┌───┴───┐       ┌───┴───┐\n google   amazon  wikipedia  ...   baidu  taobao\n    │\n  www.google.com\n</code></pre>\n<h3>域名组成</h3>\n<pre><code>www.example.com.\n│   │       │  │\n│   │       │  └── 根域 (通常省略)\n│   │       └───── 顶级域 (TLD)\n│   └───────────── 二级域\n└───────────────── 子域/主机名\n</code></pre>\n<h2>DNS 记录类型</h2>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>用途</th>\n<th>示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>A</strong></td>\n<td>域名 → IPv4</td>\n<td><code>example.com → 93.184.216.34</code></td>\n</tr>\n<tr>\n<td><strong>AAAA</strong></td>\n<td>域名 → IPv6</td>\n<td><code>example.com → 2606:2800:...</code></td>\n</tr>\n<tr>\n<td><strong>CNAME</strong></td>\n<td>域名别名</td>\n<td><code>www → example.com</code></td>\n</tr>\n<tr>\n<td><strong>MX</strong></td>\n<td>邮件服务器</td>\n<td><code>example.com → mail.example.com</code></td>\n</tr>\n<tr>\n<td><strong>TXT</strong></td>\n<td>文本记录</td>\n<td>SPF、DKIM 验证</td>\n</tr>\n<tr>\n<td><strong>NS</strong></td>\n<td>域名服务器</td>\n<td><code>example.com → ns1.example.com</code></td>\n</tr>\n<tr>\n<td><strong>SOA</strong></td>\n<td>授权起始</td>\n<td>区域主服务器信息</td>\n</tr>\n<tr>\n<td><strong>PTR</strong></td>\n<td>反向解析</td>\n<td><code>IP → 域名</code></td>\n</tr>\n</tbody>\n</table>\n<h3>记录示例</h3>\n<pre><code class=\"language-dns\">; A 记录\nexample.com.      IN  A      93.184.216.34\nwww.example.com.  IN  A      93.184.216.34\n\n; AAAA 记录\nexample.com.      IN  AAAA   2606:2800:220:1:248:1893:25c8:1946\n\n; CNAME 记录\nwww               IN  CNAME  example.com.\nblog              IN  CNAME  example.com.\n\n; MX 记录 (优先级越低越优先)\nexample.com.      IN  MX     10 mail1.example.com.\nexample.com.      IN  MX     20 mail2.example.com.\n\n; TXT 记录\nexample.com.      IN  TXT    \"v=spf1 include:_spf.google.com ~all\"\n\n; NS 记录\nexample.com.      IN  NS     ns1.example.com.\nexample.com.      IN  NS     ns2.example.com.\n</code></pre>\n<h2>DNS 解析过程</h2>\n<pre><code>用户浏览器\n    │\n    │ 1. 查询 www.example.com\n    ▼\n本地 DNS 缓存 ──(未命中)──→ 本地 DNS 服务器\n                              │\n                              │ 2. 查询根域名服务器\n                              ▼\n                         根 DNS (.)\n                              │\n                              │ 3. 返回 .com 服务器地址\n                              ▼\n                        .com DNS\n                              │\n                              │ 4. 返回 example.com 服务器地址\n                              ▼\n                   example.com DNS\n                              │\n                              │ 5. 返回 www.example.com 的 IP\n                              ▼\n                    返回 93.184.216.34\n</code></pre>\n<h3>递归查询 vs 迭代查询</h3>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>递归查询</strong></td>\n<td>客户端发一次请求，DNS 服务器完成全部查询</td>\n</tr>\n<tr>\n<td><strong>迭代查询</strong></td>\n<td>DNS 服务器返回下一步查询地址，客户端继续查询</td>\n</tr>\n</tbody>\n</table>\n<h2>DNS 工具</h2>\n<h3>nslookup</h3>\n<pre><code class=\"language-bash\"># 基本查询\nnslookup example.com\n\n# 指定 DNS 服务器\nnslookup example.com 8.8.8.8\n\n# 查询特定记录\nnslookup -type=MX example.com\nnslookup -type=TXT example.com\n</code></pre>\n<h3>dig</h3>\n<pre><code class=\"language-bash\"># 基本查询\ndig example.com\n\n# 简洁输出\ndig example.com +short\n\n# 查询特定记录\ndig example.com MX\ndig example.com TXT\ndig example.com NS\n\n# 指定 DNS 服务器\ndig @8.8.8.8 example.com\n\n# 追踪解析过程\ndig example.com +trace\n\n# 反向解析\ndig -x 93.184.216.34\n</code></pre>\n<h3>host</h3>\n<pre><code class=\"language-bash\"># 基本查询\nhost example.com\n\n# 查询所有记录\nhost -a example.com\n\n# 反向解析\nhost 93.184.216.34\n</code></pre>\n<h2>DNS 缓存</h2>\n<h3>TTL (Time To Live)</h3>\n<pre><code class=\"language-dns\">example.com.  3600  IN  A  93.184.216.34\n              │\n              └── TTL: 3600 秒 (1 小时)\n</code></pre>\n<h3>清除本地缓存</h3>\n<pre><code class=\"language-bash\"># Linux (systemd-resolved)\nsudo systemd-resolve --flush-caches\n\n# macOS\nsudo dscacheutil -flushcache\nsudo killall -HUP mDNSResponder\n\n# Windows\nipconfig /flushdns\n</code></pre>\n<h2>本地 DNS 配置</h2>\n<h3>/etc/hosts</h3>\n<pre><code class=\"language-bash\"># 本地域名映射\n127.0.0.1       localhost\n192.168.1.100   myserver.local\n192.168.1.101   db.local\n</code></pre>\n<h3>/etc/resolv.conf</h3>\n<pre><code class=\"language-bash\"># DNS 服务器配置\nnameserver 8.8.8.8\nnameserver 8.8.4.4\nsearch example.com\n</code></pre>\n<h2>常用公共 DNS</h2>\n<table>\n<thead>\n<tr>\n<th>提供商</th>\n<th>IPv4</th>\n<th>IPv6</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Google</td>\n<td>8.8.8.8, 8.8.4.4</td>\n<td>2001:4860:4860::8888</td>\n</tr>\n<tr>\n<td>Cloudflare</td>\n<td>1.1.1.1, 1.0.0.1</td>\n<td>2606:4700:4700::1111</td>\n</tr>\n<tr>\n<td>阿里云</td>\n<td>223.5.5.5, 223.6.6.6</td>\n<td>-</td>\n</tr>\n<tr>\n<td>腾讯</td>\n<td>119.29.29.29</td>\n<td>-</td>\n</tr>\n</tbody>\n</table>\n<h2>DNS 安全</h2>\n<h3>常见威胁</h3>\n<table>\n<thead>\n<tr>\n<th>威胁</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>DNS 劫持</strong></td>\n<td>篡改 DNS 响应，重定向流量</td>\n</tr>\n<tr>\n<td><strong>DNS 缓存污染</strong></td>\n<td>注入虚假 DNS 记录</td>\n</tr>\n<tr>\n<td><strong>DDoS 攻击</strong></td>\n<td>利用 DNS 放大攻击</td>\n</tr>\n</tbody>\n</table>\n<h3>安全措施</h3>\n<p><strong>DNSSEC</strong> - DNS 安全扩展</p>\n<pre><code class=\"language-bash\"># 验证 DNSSEC\ndig example.com +dnssec\n</code></pre>\n<p><strong>DoH</strong> - DNS over HTTPS</p>\n<pre><code>https://dns.google/dns-query\nhttps://cloudflare-dns.com/dns-query\n</code></pre>\n<p><strong>DoT</strong> - DNS over TLS</p>\n<pre><code>端口 853\n</code></pre>\n<h2>故障排查</h2>\n<h3>常见问题</h3>\n<pre><code class=\"language-bash\"># 1. 检查 DNS 解析\ndig example.com\n\n# 2. 检查本地配置\ncat /etc/resolv.conf\n\n# 3. 测试不同 DNS 服务器\ndig @8.8.8.8 example.com\ndig @1.1.1.1 example.com\n\n# 4. 清除缓存后重试\nsudo systemd-resolve --flush-caches\n\n# 5. 检查网络连通性\nping 8.8.8.8\n</code></pre>\n<h2>总结</h2>\n<p>DNS 是互联网基础设施的核心：</p>\n<ol>\n<li><strong>层级结构</strong>: 根域 → 顶级域 → 二级域 → 子域</li>\n<li><strong>记录类型</strong>: A、AAAA、CNAME、MX、TXT 等各有用途</li>\n<li><strong>解析过程</strong>: 递归/迭代查询，逐级查找</li>\n<li><strong>工具使用</strong>: dig、nslookup、host</li>\n<li><strong>安全防护</strong>: DNSSEC、DoH、DoT</li>\n</ol>\n"
}