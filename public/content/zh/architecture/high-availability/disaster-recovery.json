{
  "slug": "disaster-recovery",
  "meta": {
    "title": "容灾备份",
    "description": "异地多活、数据备份与恢复策略",
    "order": 3,
    "tags": [
      "高可用",
      "容灾",
      "备份"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "RPO (Recovery Point Objective)：可接受的数据丢失量",
        "RTO (Recovery Time Objective)：可接受的恢复时间",
        "容灾等级：同城、异地、两地三中心",
        "备份策略：全量、增量、差异备份"
      ]
    },
    {
      "type": "cards",
      "title": "容灾等级",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "同城双活",
          "badge": "Level 1",
          "badgeColor": "blue",
          "points": [
            "同城机房",
            "低延迟同步",
            "防单机房故障"
          ]
        },
        {
          "title": "异地灾备",
          "badge": "Level 2",
          "badgeColor": "green",
          "points": [
            "异地备份中心",
            "异步复制",
            "防区域灾难"
          ]
        },
        {
          "title": "两地三中心",
          "badge": "Level 3",
          "badgeColor": "purple",
          "points": [
            "同城+异地",
            "实时+异步",
            "金融级别"
          ]
        }
      ]
    },
    {
      "type": "table",
      "title": "RPO/RTO 与方案",
      "highlightFirst": true,
      "headers": [
        "RPO",
        "RTO",
        "方案",
        "成本"
      ],
      "rows": [
        [
          "0",
          "<1分钟",
          "同步复制+热备",
          "极高"
        ],
        [
          "<1分钟",
          "<5分钟",
          "异步复制+温备",
          "高"
        ],
        [
          "<1小时",
          "<30分钟",
          "定时备份+冷备",
          "中"
        ],
        [
          "<24小时",
          "<4小时",
          "每日备份+离线恢复",
          "低"
        ]
      ]
    },
    {
      "type": "codeBlock",
      "title": "MySQL 备份策略",
      "language": "bash",
      "code": "# 全量备份（每周）\nmysqldump --single-transaction --master-data=2 \\\n    --all-databases > full_backup_$(date +%Y%m%d).sql\n\n# 增量备份（每日）- 使用 binlog\nmysqlbinlog --start-datetime=\"2024-01-01 00:00:00\" \\\n    --stop-datetime=\"2024-01-02 00:00:00\" \\\n    mysql-bin.* > incremental_$(date +%Y%m%d).sql\n\n# 物理备份（Percona XtraBackup）\nxtrabackup --backup --target-dir=/backup/full\nxtrabackup --backup --target-dir=/backup/inc1 \\\n    --incremental-basedir=/backup/full\n\n# 恢复流程\nxtrabackup --prepare --target-dir=/backup/full\nxtrabackup --prepare --target-dir=/backup/full \\\n    --incremental-dir=/backup/inc1\nxtrabackup --copy-back --target-dir=/backup/full"
    },
    {
      "type": "codeBlock",
      "title": "异地多活架构",
      "language": "text",
      "code": "                    ┌─────────────────┐\n                    │   全局路由      │\n                    │   (GeoDNS)      │\n                    └────────┬────────┘\n                             │\n         ┌───────────────────┼───────────────────┐\n         ▼                   ▼                   ▼\n┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐\n│    北京机房     │ │    上海机房     │ │    广州机房     │\n├─────────────────┤ ├─────────────────┤ ├─────────────────┤\n│  应用层 (Active)│ │  应用层 (Active)│ │  应用层 (Active)│\n│  缓存层         │ │  缓存层         │ │  缓存层         │\n│  数据库 (主)    │ │  数据库 (从)    │ │  数据库 (从)    │\n└────────┬────────┘ └────────┬────────┘ └────────┬────────┘\n         │                   │                   │\n         └───────────────────┴───────────────────┘\n                    数据同步通道\n\n单元化设计：\n- 按用户 ID 分片路由到固定机房\n- 本机房闭环处理，减少跨机房调用\n- 只有必要数据跨机房同步"
    },
    {
      "type": "comparison",
      "title": "冷备 vs 热备",
      "columns": [
        {
          "title": "冷备",
          "color": "from-gray-500 to-slate-500",
          "items": [
            {
              "label": "状态",
              "description": "备用系统关闭"
            },
            {
              "label": "RTO",
              "description": "小时级"
            },
            {
              "label": "成本",
              "description": "低（只需存储）"
            },
            {
              "label": "场景",
              "description": "非核心系统"
            }
          ]
        },
        {
          "title": "热备",
          "color": "from-red-500 to-orange-500",
          "items": [
            {
              "label": "状态",
              "description": "实时运行"
            },
            {
              "label": "RTO",
              "description": "分钟级"
            },
            {
              "label": "成本",
              "description": "高（双倍资源）"
            },
            {
              "label": "场景",
              "description": "核心业务"
            }
          ]
        }
      ]
    },
    {
      "type": "list",
      "title": "容灾演练",
      "style": "check",
      "items": [
        {
          "label": "定期演练",
          "description": "至少每季度一次全量演练"
        },
        {
          "label": "自动化脚本",
          "description": "切换操作自动化，减少人为错误"
        },
        {
          "label": "监控告警",
          "description": "同步延迟、备份状态实时监控"
        },
        {
          "label": "文档更新",
          "description": "保持恢复手册最新"
        }
      ]
    }
  ],
  "relatedTopics": [
    "数据备份",
    "异地多活",
    "Chaos Engineering"
  ]
}