{
  "slug": "storage",
  "meta": {
    "title": "Docker 存储",
    "description": "Docker 数据持久化：Volume、Bind Mount 与存储驱动",
    "order": 4,
    "tags": [
      "Docker",
      "存储",
      "Volume",
      "数据持久化"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "容器文件系统是临时的，容器删除数据即丢失",
        "Volume 是 Docker 管理的持久化存储",
        "Bind Mount 直接映射宿主机目录",
        "tmpfs 存储在内存中，适合敏感数据"
      ]
    },
    {
      "type": "comparison",
      "title": "存储类型对比",
      "columns": [
        {
          "title": "Volume",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            {
              "label": "管理方式",
              "description": "Docker 管理"
            },
            {
              "label": "存储位置",
              "description": "/var/lib/docker/volumes/"
            },
            {
              "label": "可移植性",
              "description": "高，跨平台"
            },
            {
              "label": "推荐场景",
              "description": "生产环境数据持久化"
            }
          ]
        },
        {
          "title": "Bind Mount",
          "color": "from-green-500 to-emerald-500",
          "items": [
            {
              "label": "管理方式",
              "description": "用户管理"
            },
            {
              "label": "存储位置",
              "description": "任意宿主机路径"
            },
            {
              "label": "可移植性",
              "description": "低，依赖宿主机"
            },
            {
              "label": "推荐场景",
              "description": "开发环境代码挂载"
            }
          ]
        },
        {
          "title": "tmpfs",
          "color": "from-amber-500 to-orange-500",
          "items": [
            {
              "label": "管理方式",
              "description": "内存存储"
            },
            {
              "label": "存储位置",
              "description": "宿主机内存"
            },
            {
              "label": "可移植性",
              "description": "中，Linux only"
            },
            {
              "label": "推荐场景",
              "description": "敏感数据/临时缓存"
            }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "Volume 操作",
      "language": "bash",
      "code": "# 创建 Volume\ndocker volume create mydata\n\n# 查看 Volume 列表\ndocker volume ls\n\n# 查看 Volume 详情\ndocker volume inspect mydata\n\n# 使用 Volume 运行容器\ndocker run -d \\\n  --name myapp \\\n  -v mydata:/app/data \\\n  nginx\n\n# 匿名 Volume (自动创建)\ndocker run -d -v /app/data nginx\n\n# 删除 Volume\ndocker volume rm mydata\n\n# 清理未使用的 Volume\ndocker volume prune"
    },
    {
      "type": "codeBlock",
      "title": "Bind Mount 使用",
      "language": "bash",
      "code": "# 挂载宿主机目录 (推荐使用 --mount)\ndocker run -d \\\n  --name devapp \\\n  --mount type=bind,source=/home/user/code,target=/app \\\n  node:18\n\n# 使用 -v 简写形式\ndocker run -d \\\n  -v /home/user/code:/app \\\n  node:18\n\n# 只读挂载\ndocker run -d \\\n  -v /home/user/config:/app/config:ro \\\n  myapp\n\n# 开发环境热重载示例\ndocker run -d \\\n  -v $(pwd):/app \\\n  -v /app/node_modules \\\n  -p 3000:3000 \\\n  node:18 npm run dev"
    },
    {
      "type": "codeBlock",
      "title": "tmpfs 挂载",
      "language": "bash",
      "code": "# tmpfs 挂载 (数据存储在内存)\ndocker run -d \\\n  --name secure-app \\\n  --tmpfs /app/secrets:rw,size=64m \\\n  myapp\n\n# 使用 --mount 语法\ndocker run -d \\\n  --mount type=tmpfs,target=/app/tmp,tmpfs-size=100m \\\n  myapp"
    },
    {
      "type": "cards",
      "title": "Volume 高级特性",
      "layout": "grid",
      "columns": 2,
      "items": [
        {
          "title": "Volume 驱动",
          "badge": "扩展",
          "badgeColor": "blue",
          "points": [
            "local: 默认本地存储",
            "nfs: NFS 网络存储",
            "ceph: Ceph 分布式存储",
            "支持第三方插件"
          ]
        },
        {
          "title": "数据共享",
          "badge": "容器间",
          "badgeColor": "green",
          "points": [
            "多容器共享同一 Volume",
            "--volumes-from 复制挂载",
            "注意并发写入问题"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "Volume 备份与恢复",
      "language": "bash",
      "code": "# 备份 Volume 数据\ndocker run --rm \\\n  -v mydata:/source:ro \\\n  -v $(pwd):/backup \\\n  alpine tar czf /backup/mydata-backup.tar.gz -C /source .\n\n# 恢复 Volume 数据\ndocker run --rm \\\n  -v mydata:/target \\\n  -v $(pwd):/backup \\\n  alpine tar xzf /backup/mydata-backup.tar.gz -C /target\n\n# 使用 NFS Volume 驱动\ndocker volume create \\\n  --driver local \\\n  --opt type=nfs \\\n  --opt o=addr=192.168.1.100,rw \\\n  --opt device=:/path/to/dir \\\n  nfs-data"
    },
    {
      "type": "table",
      "title": "存储选择指南",
      "highlightFirst": true,
      "headers": [
        "场景",
        "推荐类型",
        "原因"
      ],
      "rows": [
        [
          "数据库数据",
          "Volume",
          "Docker 管理，易于备份"
        ],
        [
          "开发代码挂载",
          "Bind Mount",
          "实时同步宿主机文件"
        ],
        [
          "配置文件",
          "Bind Mount (只读)",
          "便于修改和版本控制"
        ],
        [
          "敏感信息/密钥",
          "tmpfs",
          "不写入磁盘，更安全"
        ],
        [
          "日志文件",
          "Volume",
          "持久化且便于收集"
        ],
        [
          "缓存数据",
          "tmpfs/Volume",
          "根据是否需要持久化选择"
        ]
      ]
    },
    {
      "type": "list",
      "title": "存储最佳实践",
      "style": "check",
      "items": [
        {
          "label": "生产使用 Volume",
          "description": "比 Bind Mount 更安全、更易管理"
        },
        {
          "label": "命名 Volume",
          "description": "避免使用匿名 Volume，便于管理"
        },
        {
          "label": "定期备份",
          "description": "重要数据建立备份策略"
        },
        {
          "label": "只读挂载",
          "description": "配置文件使用 :ro 防止意外修改"
        },
        {
          "label": "避免存储敏感数据",
          "description": "密钥使用 Secret 管理或 tmpfs"
        }
      ]
    }
  ],
  "relatedTopics": [
    "Docker 基础",
    "Docker Compose",
    "Kubernetes 存储"
  ]
}