{
  "slug": "firewall",
  "meta": {
    "title": "ファイアウォール",
    "description": "ネットワークファイアウォールとセキュリティグループ設定",
    "order": 2,
    "tags": [
      "ファイアウォール",
      "iptables",
      "セキュリティグループ"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コアコンセプト",
      "items": [
        "ファイアウォール：ネットワークトラフィックのアクセス制御",
        "ステートフルファイアウォール：接続状態を追跡",
        "セキュリティグループ：クラウド環境の仮想ファイアウォール",
        "デフォルト拒否原則：必要なポートのみ開放"
      ]
    },
    {
      "type": "codeBlock",
      "title": "iptables 基本設定",
      "language": "bash",
      "code": "# デフォルトポリシー：すべてのインバウンドを拒否\niptables -P INPUT DROP\niptables -P FORWARD DROP\niptables -P OUTPUT ACCEPT\n\n# ローカルループバックを許可\niptables -A INPUT -i lo -j ACCEPT\n\n# 確立済み接続を許可\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# SSH許可（送信元IP制限）\niptables -A INPUT -p tcp --dport 22 -s 10.0.0.0/8 -j ACCEPT\n\n# HTTP/HTTPS許可\niptables -A INPUT -p tcp --dport 80 -j ACCEPT\niptables -A INPUT -p tcp --dport 443 -j ACCEPT\n\n# ICMP制限（pingフラッド防止）\niptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/s -j ACCEPT\n\n# 拒否されたトラフィックをログ\niptables -A INPUT -j LOG --log-prefix \"IPTables-Dropped: \"\n\n# ルールを保存\niptables-save > /etc/iptables/rules.v4"
    },
    {
      "type": "codeBlock",
      "title": "AWSセキュリティグループ設定",
      "language": "yaml",
      "code": "# Terraform セキュリティグループ定義\nresource \"aws_security_group\" \"web\" {\n  name        = \"web-server-sg\"\n  description = \"Security group for web servers\"\n  vpc_id      = aws_vpc.main.id\n\n  # インバウンドルール\n  ingress {\n    description = \"HTTPS from anywhere\"\n    from_port   = 443\n    to_port     = 443\n    protocol    = \"tcp\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n\n  ingress {\n    description = \"HTTP from anywhere\"\n    from_port   = 80\n    to_port     = 80\n    protocol    = \"tcp\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n\n  ingress {\n    description     = \"SSH from bastion\"\n    from_port       = 22\n    to_port         = 22\n    protocol        = \"tcp\"\n    security_groups = [aws_security_group.bastion.id]\n  }\n\n  # アウトバウンドルール\n  egress {\n    from_port   = 0\n    to_port     = 0\n    protocol    = \"-1\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n\n  tags = {\n    Name = \"web-server-sg\"\n  }\n}"
    },
    {
      "type": "table",
      "title": "一般的なポートセキュリティポリシー",
      "highlightFirst": true,
      "headers": [
        "ポート",
        "サービス",
        "ポリシー",
        "説明"
      ],
      "rows": [
        [
          "22",
          "SSH",
          "送信元IP制限",
          "踏み台サーバー経由のみ"
        ],
        [
          "80/443",
          "HTTP/S",
          "公開",
          "Webサービス"
        ],
        [
          "3306",
          "MySQL",
          "内部ネットワーク",
          "パブリックアクセス禁止"
        ],
        [
          "6379",
          "Redis",
          "内部ネットワーク",
          "パブリックアクセス禁止"
        ],
        [
          "9090",
          "Prometheus",
          "内部ネットワーク",
          "監視サービス"
        ]
      ]
    },
    {
      "type": "list",
      "title": "ベストプラクティス",
      "style": "check",
      "items": [
        {
          "label": "最小権限",
          "description": "必要なポートのみ開放"
        },
        {
          "label": "多層防御",
          "description": "ネットワーク層 + ホスト層 + アプリケーション層"
        },
        {
          "label": "セキュリティグループ分離",
          "description": "異なるロールに異なるセキュリティグループ"
        },
        {
          "label": "ログ監査",
          "description": "拒否されたすべての接続を記録"
        }
      ]
    }
  ],
  "relatedTopics": [
    "ネットワークセキュリティ",
    "ゼロトラスト",
    "VPC"
  ]
}