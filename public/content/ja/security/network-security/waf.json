{
  "slug": "waf",
  "meta": {
    "title": "WAF",
    "description": "Webアプリケーションファイアウォールのルールとポリシー",
    "order": 3,
    "tags": [
      "WAF",
      "Webセキュリティ",
      "防御"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コアコンセプト",
      "items": [
        "WAF：アプリケーション層（L7）の防御",
        "防御対象：SQLインジェクション、XSS、CSRF、ファイルアップロードなど",
        "モード：ブロックモード、検出モード",
        "ルール：OWASP CRS、カスタムルール"
      ]
    },
    {
      "type": "cards",
      "title": "防御機能",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "インジェクション防御",
          "badge": "A03",
          "badgeColor": "blue",
          "points": [
            "SQLインジェクション",
            "コマンドインジェクション",
            "LDAPインジェクション"
          ]
        },
        {
          "title": "XSS防御",
          "badge": "A07",
          "badgeColor": "green",
          "points": [
            "反射型XSS",
            "格納型XSS",
            "DOM XSS"
          ]
        },
        {
          "title": "アクセス制御",
          "badge": "レート制限",
          "badgeColor": "purple",
          "points": [
            "IPブラック/ホワイトリスト",
            "リクエスト頻度制限",
            "Bot防御"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "ModSecurity設定",
      "language": "apache",
      "code": "# ModSecurityロード\nLoadModule security2_module modules/mod_security2.so\n\n# 基本設定\nSecRuleEngine On\nSecRequestBodyAccess On\nSecResponseBodyAccess Off\n\n# OWASP CRSルールロード\nInclude /etc/modsecurity/crs/crs-setup.conf\nInclude /etc/modsecurity/crs/rules/*.conf\n\n# カスタムルール：SQLインジェクションブロック\nSecRule ARGS|ARGS_NAMES \"@rx (?i)(union.*select|select.*from|insert.*into)\" \\\n    \"id:1001,phase:2,block,log,msg:'SQL Injection Attempt'\"\n\n# カスタムルール：XSSブロック\nSecRule ARGS|ARGS_NAMES \"@rx <script[^>]*>|javascript:\" \\\n    \"id:1002,phase:2,block,log,msg:'XSS Attempt'\"\n\n# リクエストボディサイズ制限\nSecRequestBodyLimit 10485760\nSecRequestBodyNoFilesLimit 131072\n\n# 特定パスをホワイトリスト\nSecRule REQUEST_URI \"@beginsWith /api/webhook\" \\\n    \"id:1003,phase:1,nolog,allow\""
    },
    {
      "type": "codeBlock",
      "title": "AWS WAFルール設定",
      "language": "json",
      "code": "{\n  \"Name\": \"WebACL\",\n  \"DefaultAction\": { \"Allow\": {} },\n  \"Rules\": [\n    {\n      \"Name\": \"AWSManagedRulesCommonRuleSet\",\n      \"Priority\": 1,\n      \"Statement\": {\n        \"ManagedRuleGroupStatement\": {\n          \"VendorName\": \"AWS\",\n          \"Name\": \"AWSManagedRulesCommonRuleSet\"\n        }\n      },\n      \"OverrideAction\": { \"None\": {} }\n    },\n    {\n      \"Name\": \"AWSManagedRulesSQLiRuleSet\",\n      \"Priority\": 2,\n      \"Statement\": {\n        \"ManagedRuleGroupStatement\": {\n          \"VendorName\": \"AWS\",\n          \"Name\": \"AWSManagedRulesSQLiRuleSet\"\n        }\n      },\n      \"OverrideAction\": { \"None\": {} }\n    },\n    {\n      \"Name\": \"RateLimitRule\",\n      \"Priority\": 3,\n      \"Statement\": {\n        \"RateBasedStatement\": {\n          \"Limit\": 2000,\n          \"AggregateKeyType\": \"IP\"\n        }\n      },\n      \"Action\": { \"Block\": {} }\n    }\n  ]\n}"
    },
    {
      "type": "table",
      "title": "WAF製品比較",
      "highlightFirst": true,
      "headers": [
        "製品",
        "タイプ",
        "特徴",
        "適用"
      ],
      "rows": [
        [
          "AWS WAF",
          "クラウドサービス",
          "マネージドルール、CloudFront統合",
          "AWSユーザー"
        ],
        [
          "Cloudflare",
          "エッジ",
          "グローバルCDN、無料版あり",
          "各種Webサイト"
        ],
        [
          "ModSecurity",
          "オープンソース",
          "柔軟、カスタムルール",
          "オンプレミス"
        ],
        [
          "AWS WAF Japan",
          "クラウドサービス",
          "日本リージョン、マネージドルール",
          "日本ユーザー"
        ]
      ]
    },
    {
      "type": "list",
      "title": "設定アドバイス",
      "style": "check",
      "items": [
        {
          "label": "検出優先でブロック",
          "description": "新しいルールは検出モードで観察してから"
        },
        {
          "label": "ホワイトリスト優先",
          "description": "信頼できるパス/IPはホワイトリスト設定"
        },
        {
          "label": "ログ分析",
          "description": "ブロックログを定期的に分析してルール最適化"
        },
        {
          "label": "誤検知対応",
          "description": "誤検知は速やかに対応し、ルールを最適化"
        }
      ]
    }
  ],
  "relatedTopics": [
    "OWASP",
    "ファイアウォール",
    "DDoS防御"
  ]
}