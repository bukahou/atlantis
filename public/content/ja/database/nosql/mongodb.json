{
  "slug": "mongodb",
  "meta": {
    "title": "MongoDB",
    "description": "MongoDB ドキュメントデータベース、クエリ操作と集約パイプライン",
    "order": 1,
    "tags": [
      "MongoDB",
      "NoSQL",
      "ドキュメントデータベース"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コア概念",
      "items": [
        "MongoDB はドキュメント指向の NoSQL データベース",
        "BSON 形式で保存、柔軟な Schema",
        "強力な集約フレームワーク",
        "レプリカセットで高可用性、シャーディングで水平スケーリング"
      ]
    },
    {
      "type": "codeBlock",
      "title": "CRUD 操作",
      "language": "javascript",
      "code": "// ドキュメントの挿入\ndb.users.insertOne({\n  name: \"Alice\",\n  email: \"alice@example.com\",\n  tags: [\"developer\", \"golang\"]\n});\n\n// クエリ\ndb.users.find({ age: { $gt: 25 } });\ndb.users.findOne({ email: \"alice@example.com\" });\n\n// 更新\ndb.users.updateOne(\n  { email: \"alice@example.com\" },\n  { $set: { age: 29 }, $push: { tags: \"k8s\" } }\n);\n\n// 削除\ndb.users.deleteOne({ email: \"alice@example.com\" });"
    },
    {
      "type": "cards",
      "title": "クエリ演算子",
      "layout": "grid",
      "columns": 2,
      "items": [
        {
          "title": "比較演算子",
          "badge": "Compare",
          "badgeColor": "blue",
          "points": [
            "$eq, $ne 等しい/等しくない",
            "$gt, $gte より大きい",
            "$lt, $lte より小さい",
            "$in, $nin リストマッチング"
          ]
        },
        {
          "title": "論理演算子",
          "badge": "Logic",
          "badgeColor": "green",
          "points": [
            "$and AND条件",
            "$or OR条件",
            "$not NOT条件",
            "$nor いずれも満たさない"
          ]
        },
        {
          "title": "配列演算子",
          "badge": "Array",
          "badgeColor": "purple",
          "points": [
            "$all すべてを含む",
            "$size 配列の長さ",
            "$elemMatch 要素マッチング"
          ]
        },
        {
          "title": "要素演算子",
          "badge": "Element",
          "badgeColor": "amber",
          "points": [
            "$exists フィールドの存在",
            "$type 型マッチング"
          ]
        }
      ]
    },
    {
      "type": "table",
      "title": "インデックスの種類",
      "highlightFirst": true,
      "headers": [
        "インデックスタイプ",
        "作成方法",
        "用途"
      ],
      "rows": [
        [
          "単一フィールド",
          "{ email: 1 }",
          "通常クエリ"
        ],
        [
          "複合",
          "{ name: 1, age: -1 }",
          "複数フィールドクエリ"
        ],
        [
          "ユニーク",
          "{ unique: true }",
          "重複制約"
        ],
        [
          "テキスト",
          "{ type: \"text\" }",
          "全文検索"
        ],
        [
          "TTL",
          "{ expireAfterSeconds }",
          "自動有効期限"
        ],
        [
          "地理空間",
          "{ type: \"2dsphere\" }",
          "位置クエリ"
        ]
      ]
    },
    {
      "type": "flow",
      "title": "集約パイプライン",
      "direction": "horizontal",
      "steps": [
        {
          "label": "$match",
          "description": "ドキュメントのフィルタリング",
          "color": "bg-blue-500"
        },
        {
          "label": "$group",
          "description": "グループ集約",
          "color": "bg-purple-500"
        },
        {
          "label": "$sort",
          "description": "ソート",
          "color": "bg-cyan-500"
        },
        {
          "label": "$project",
          "description": "投影",
          "color": "bg-green-500"
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "集約の例",
      "language": "javascript",
      "code": "db.orders.aggregate([\n  { $match: { status: \"completed\" } },\n  { $group: {\n      _id: \"$userId\",\n      totalAmount: { $sum: \"$amount\" },\n      orderCount: { $sum: 1 }\n  }},\n  { $sort: { totalAmount: -1 } },\n  { $limit: 10 }\n]);\n\n// Lookup 関連クエリ\ndb.orders.aggregate([\n  { $lookup: {\n      from: \"users\",\n      localField: \"userId\",\n      foreignField: \"_id\",\n      as: \"user\"\n  }},\n  { $unwind: \"$user\" }\n]);"
    },
    {
      "type": "comparison",
      "title": "高可用性アーキテクチャ",
      "columns": [
        {
          "title": "レプリカセット",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            {
              "label": "構成",
              "description": "Primary + Secondary + Arbiter"
            },
            {
              "label": "特徴",
              "description": "自動フェイルオーバー"
            },
            {
              "label": "読み取り",
              "description": "読み取り優先設定可能"
            }
          ]
        },
        {
          "title": "シャードクラスタ",
          "color": "from-green-500 to-emerald-500",
          "items": [
            {
              "label": "構成",
              "description": "mongos + config + shard"
            },
            {
              "label": "特徴",
              "description": "水平スケーリング"
            },
            {
              "label": "戦略",
              "description": "範囲/ハッシュ/ゾーンシャーディング"
            }
          ]
        }
      ]
    },
    {
      "type": "list",
      "title": "ベストプラクティス",
      "style": "check",
      "items": [
        {
          "label": "適切なモデリング",
          "description": "埋め込み vs 参照、深いネストを避ける"
        },
        {
          "label": "インデックス最適化",
          "description": "カバリングインデックス、フルテーブルスキャンを避ける"
        },
        {
          "label": "一括操作",
          "description": "insertMany/bulkWrite"
        },
        {
          "label": "コネクションプール",
          "description": "接続の再利用、適切なサイズの設定"
        }
      ]
    }
  ],
  "relatedTopics": [
    "Redis",
    "Elasticsearch",
    "集約クエリ"
  ]
}