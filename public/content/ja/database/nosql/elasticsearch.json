{
  "slug": "elasticsearch",
  "meta": {
    "title": "Elasticsearch",
    "description": "Elasticsearch 全文検索エンジン、インデックスとクエリ DSL",
    "order": 3,
    "tags": [
      "Elasticsearch",
      "検索エンジン",
      "NoSQL"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コア概念",
      "items": [
        "Elasticsearch は分散型検索・分析エンジン",
        "Lucene ベース、転置インデックスで全文検索を実現",
        "ほぼリアルタイム検索、秒単位の遅延",
        "RESTful API、JSON 形式でやり取り"
      ]
    },
    {
      "type": "cards",
      "title": "コア用語",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "Index",
          "badge": "インデックス",
          "badgeColor": "blue",
          "points": [
            "データベースに類似",
            "複数のドキュメントを含む",
            "Mapping を定義"
          ]
        },
        {
          "title": "Document",
          "badge": "ドキュメント",
          "badgeColor": "green",
          "points": [
            "データ行に類似",
            "JSON 形式",
            "ユニークな _id"
          ]
        },
        {
          "title": "Shard",
          "badge": "シャード",
          "badgeColor": "purple",
          "points": [
            "データの水平分割",
            "並列処理",
            "Replica レプリカ"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "インデックスとドキュメント操作",
      "language": "json",
      "code": "// インデックスの作成\nPUT /products\n{\n  \"settings\": { \"number_of_shards\": 3 },\n  \"mappings\": {\n    \"properties\": {\n      \"name\": { \"type\": \"text\" },\n      \"price\": { \"type\": \"float\" },\n      \"category\": { \"type\": \"keyword\" }\n    }\n  }\n}\n\n// ドキュメントのインデックス\nPUT /products/_doc/1\n{ \"name\": \"iPhone\", \"price\": 999.99, \"category\": \"electronics\" }\n\n// 一括操作\nPOST /_bulk\n{\"index\": {\"_index\": \"products\", \"_id\": \"1\"}}\n{\"name\": \"Product 1\"}"
    },
    {
      "type": "comparison",
      "title": "クエリタイプ",
      "columns": [
        {
          "title": "Match",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            {
              "label": "用途",
              "description": "全文検索"
            },
            {
              "label": "特徴",
              "description": "分詞マッチング"
            }
          ]
        },
        {
          "title": "Term",
          "color": "from-green-500 to-emerald-500",
          "items": [
            {
              "label": "用途",
              "description": "完全一致"
            },
            {
              "label": "特徴",
              "description": "分詞しない"
            }
          ]
        },
        {
          "title": "Bool",
          "color": "from-purple-500 to-pink-500",
          "items": [
            {
              "label": "用途",
              "description": "組み合わせクエリ"
            },
            {
              "label": "特徴",
              "description": "must/should/filter"
            }
          ]
        },
        {
          "title": "Range",
          "color": "from-amber-500 to-orange-500",
          "items": [
            {
              "label": "用途",
              "description": "範囲クエリ"
            },
            {
              "label": "特徴",
              "description": "gte/lte"
            }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "Bool クエリの例",
      "language": "json",
      "code": "GET /products/_search\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        { \"match\": { \"name\": \"phone\" } }\n      ],\n      \"filter\": [\n        { \"term\": { \"category\": \"electronics\" } },\n        { \"range\": { \"price\": { \"lte\": 1000 } } }\n      ],\n      \"should\": [\n        { \"term\": { \"tags\": \"5g\" } }\n      ]\n    }\n  },\n  \"highlight\": { \"fields\": { \"name\": {} } }\n}"
    },
    {
      "type": "table",
      "title": "集約タイプ",
      "highlightFirst": true,
      "headers": [
        "タイプ",
        "用途",
        "例"
      ],
      "rows": [
        [
          "Terms",
          "グループ統計",
          "カテゴリ別の数量統計"
        ],
        [
          "Range",
          "範囲グルーピング",
          "価格帯別グルーピング"
        ],
        [
          "Date Histogram",
          "時間グルーピング",
          "月別注文統計"
        ],
        [
          "Stats",
          "統計指標",
          "平均値/最大/最小"
        ],
        [
          "Nested",
          "ネスト集約",
          "グルーピング後の再集約"
        ]
      ]
    },
    {
      "type": "codeBlock",
      "title": "集約の例",
      "language": "json",
      "code": "GET /orders/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"by_category\": {\n      \"terms\": { \"field\": \"category\" },\n      \"aggs\": {\n        \"avg_price\": { \"avg\": { \"field\": \"price\" } },\n        \"total_sales\": { \"sum\": { \"field\": \"amount\" } }\n      }\n    }\n  }\n}"
    },
    {
      "type": "list",
      "title": "パフォーマンス最適化",
      "style": "check",
      "items": [
        {
          "label": "適切なシャーディング",
          "description": "単一シャード 10-50GB、過剰なシャードを避ける"
        },
        {
          "label": "Filter の使用",
          "description": "Filter はキャッシュ可能、Query より高速"
        },
        {
          "label": "一括操作",
          "description": "_bulk API で一括インデックス"
        },
        {
          "label": "深いページングを避ける",
          "description": "from/size の代わりに search_after を使用"
        }
      ]
    }
  ],
  "relatedTopics": [
    "全文検索",
    "ログ分析",
    "ELK Stack"
  ]
}