{
  "slug": "redis",
  "meta": {
    "title": "Redis",
    "description": "Redis インメモリデータベース、データ構造とキャッシュ戦略",
    "order": 2,
    "tags": [
      "Redis",
      "キャッシュ",
      "NoSQL"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コア概念",
      "items": [
        "Redis は高性能インメモリキーバリューデータベース",
        "豊富なデータ構造をサポート：String, Hash, List, Set, ZSet",
        "永続化：RDB スナップショット + AOF ログ",
        "高可用性：マスタースレーブレプリケーション、Sentinel、Cluster"
      ]
    },
    {
      "type": "cards",
      "title": "データ構造",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "String",
          "badge": "基本",
          "badgeColor": "blue",
          "points": [
            "SET/GET",
            "INCR/DECR",
            "EX 有効期限"
          ]
        },
        {
          "title": "Hash",
          "badge": "オブジェクト",
          "badgeColor": "green",
          "points": [
            "HSET/HGET",
            "HGETALL",
            "オブジェクト保存に最適"
          ]
        },
        {
          "title": "List",
          "badge": "キュー",
          "badgeColor": "amber",
          "points": [
            "LPUSH/RPOP",
            "BLPOP ブロッキング",
            "メッセージキュー"
          ]
        },
        {
          "title": "Set",
          "badge": "集合",
          "badgeColor": "purple",
          "points": [
            "SADD/SMEMBERS",
            "積/和/差集合",
            "重複排除タグ"
          ]
        },
        {
          "title": "ZSet",
          "badge": "ランキング",
          "badgeColor": "red",
          "points": [
            "ZADD/ZRANGE",
            "スコア順ソート",
            "ランキングボード"
          ]
        },
        {
          "title": "Stream",
          "badge": "メッセージ",
          "badgeColor": "cyan",
          "points": [
            "XADD/XREAD",
            "コンシューマグループ",
            "永続化MQ"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "よく使うコマンド",
      "language": "bash",
      "code": "# String\nSET key value EX 3600\nGET key\nINCR counter\n\n# Hash\nHSET user:1 name \"Alice\" age 28\nHGETALL user:1\n\n# List (キュー)\nLPUSH queue item1 item2\nBRPOP queue 10\n\n# Sorted Set (ランキング)\nZADD leaderboard 100 \"player1\" 200 \"player2\"\nZREVRANGE leaderboard 0 9 WITHSCORES"
    },
    {
      "type": "comparison",
      "title": "キャッシュの問題と解決策",
      "columns": [
        {
          "title": "キャッシュ穿通",
          "color": "from-red-500 to-orange-500",
          "items": [
            {
              "label": "問題",
              "description": "存在しないデータのクエリ"
            },
            {
              "label": "解決",
              "description": "ブルームフィルター/空値キャッシュ"
            }
          ]
        },
        {
          "title": "キャッシュ突破",
          "color": "from-amber-500 to-yellow-500",
          "items": [
            {
              "label": "問題",
              "description": "ホットキーの有効期限切れ"
            },
            {
              "label": "解決",
              "description": "ミューテックスロック/論理的有効期限"
            }
          ]
        },
        {
          "title": "キャッシュ雪崩",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            {
              "label": "問題",
              "description": "大量のキーが同時に期限切れ"
            },
            {
              "label": "解決",
              "description": "有効期限にランダム値を追加"
            }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "分散ロック",
      "language": "lua",
      "code": "-- ロック取得\nSET lock:resource uuid EX 30 NX\n\n-- ロック解除 (Lua スクリプトで原子性を保証)\nif redis.call(\"get\", KEYS[1]) == ARGV[1] then\n    return redis.call(\"del\", KEYS[1])\nelse\n    return 0\nend\n\n-- Redlock: 複数ノードでロック取得、過半数成功でロック取得成功"
    },
    {
      "type": "table",
      "title": "永続化の比較",
      "highlightFirst": true,
      "headers": [
        "方式",
        "原理",
        "メリット",
        "デメリット"
      ],
      "rows": [
        [
          "RDB",
          "定期スナップショット",
          "復元が速い、ファイルが小さい",
          "データ損失の可能性"
        ],
        [
          "AOF",
          "コマンドログ",
          "データが安全",
          "ファイルが大きい、復元が遅い"
        ],
        [
          "混合",
          "RDB+AOF",
          "両方の利点",
          "推奨使用"
        ]
      ]
    },
    {
      "type": "flow",
      "title": "クラスタアーキテクチャ",
      "direction": "horizontal",
      "steps": [
        {
          "label": "マスタースレーブレプリケーション",
          "description": "読み書き分離",
          "color": "bg-blue-500"
        },
        {
          "label": "Sentinelモード",
          "description": "自動フェイルオーバー",
          "color": "bg-purple-500"
        },
        {
          "label": "Cluster",
          "description": "シャードクラスタ",
          "color": "bg-green-500"
        }
      ]
    },
    {
      "type": "list",
      "title": "ベストプラクティス",
      "style": "check",
      "items": [
        {
          "label": "有効期限の設定",
          "description": "メモリの無限増大を防ぐ"
        },
        {
          "label": "Pipeline の使用",
          "description": "一括操作でネットワークラウンドトリップを削減"
        },
        {
          "label": "大きなキーを避ける",
          "description": "単一キーは10MBを超えない"
        },
        {
          "label": "Lua スクリプト",
          "description": "複雑な操作の原子性を保証"
        }
      ]
    }
  ],
  "relatedTopics": [
    "MongoDB",
    "キャッシュ戦略",
    "分散ロック"
  ]
}