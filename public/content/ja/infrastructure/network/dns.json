{
  "slug": "dns",
  "meta": {
    "title": "DNS ドメインネームシステム",
    "description": "ドメイン名解決の仕組みと DNS 設定を理解する",
    "order": 2,
    "tags": [
      "network",
      "dns",
      "domain"
    ]
  },
  "content": "<h1>DNS ドメインネームシステム</h1>\n<h2>DNS とは</h2>\n<p>DNS (Domain Name System) はインターネットの「電話帳」で、人間が読めるドメイン名を機械が読める IP アドレスに変換します。</p>\n<pre><code>ユーザー入力: www.example.com\n    ↓ DNS 解決\n返却 IP: 93.184.216.34\n</code></pre>\n<h2>DNS 階層構造</h2>\n<pre><code>                    ルートドメイン (.)\n                        │\n        ┌───────────────┼───────────────┐\n        │               │               │\n      .com            .org            .jp\n        │               │               │\n    ┌───┴───┐       ┌───┴───┐       ┌───┴───┐\n google   amazon  wikipedia  ...   yahoo  rakuten\n    │\n  www.google.com\n</code></pre>\n<h3>ドメイン名の構成</h3>\n<pre><code>www.example.com.\n│   │       │  │\n│   │       │  └── ルートドメイン (通常省略)\n│   │       └───── トップレベルドメイン (TLD)\n│   └───────────── セカンドレベルドメイン\n└───────────────── サブドメイン/ホスト名\n</code></pre>\n<h2>DNS レコードタイプ</h2>\n<table>\n<thead>\n<tr>\n<th>タイプ</th>\n<th>用途</th>\n<th>例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>A</strong></td>\n<td>ドメイン → IPv4</td>\n<td><code>example.com → 93.184.216.34</code></td>\n</tr>\n<tr>\n<td><strong>AAAA</strong></td>\n<td>ドメイン → IPv6</td>\n<td><code>example.com → 2606:2800:...</code></td>\n</tr>\n<tr>\n<td><strong>CNAME</strong></td>\n<td>ドメインエイリアス</td>\n<td><code>www → example.com</code></td>\n</tr>\n<tr>\n<td><strong>MX</strong></td>\n<td>メールサーバー</td>\n<td><code>example.com → mail.example.com</code></td>\n</tr>\n<tr>\n<td><strong>TXT</strong></td>\n<td>テキストレコード</td>\n<td>SPF、DKIM 検証</td>\n</tr>\n<tr>\n<td><strong>NS</strong></td>\n<td>ネームサーバー</td>\n<td><code>example.com → ns1.example.com</code></td>\n</tr>\n<tr>\n<td><strong>SOA</strong></td>\n<td>権威の開始</td>\n<td>ゾーンのプライマリサーバー情報</td>\n</tr>\n<tr>\n<td><strong>PTR</strong></td>\n<td>逆引き</td>\n<td><code>IP → ドメイン</code></td>\n</tr>\n</tbody>\n</table>\n<h3>レコード例</h3>\n<pre><code class=\"language-dns\">; A レコード\nexample.com.      IN  A      93.184.216.34\nwww.example.com.  IN  A      93.184.216.34\n\n; AAAA レコード\nexample.com.      IN  AAAA   2606:2800:220:1:248:1893:25c8:1946\n\n; CNAME レコード\nwww               IN  CNAME  example.com.\nblog              IN  CNAME  example.com.\n\n; MX レコード (優先度が低いほど優先)\nexample.com.      IN  MX     10 mail1.example.com.\nexample.com.      IN  MX     20 mail2.example.com.\n\n; TXT レコード\nexample.com.      IN  TXT    \"v=spf1 include:_spf.google.com ~all\"\n\n; NS レコード\nexample.com.      IN  NS     ns1.example.com.\nexample.com.      IN  NS     ns2.example.com.\n</code></pre>\n<h2>DNS 解決プロセス</h2>\n<pre><code>ユーザーブラウザ\n    │\n    │ 1. www.example.com を問い合わせ\n    ▼\nローカル DNS キャッシュ ──(ミス)──→ ローカル DNS サーバー\n                                    │\n                                    │ 2. ルートネームサーバーに問い合わせ\n                                    ▼\n                               ルート DNS (.)\n                                    │\n                                    │ 3. .com サーバーアドレスを返却\n                                    ▼\n                              .com DNS\n                                    │\n                                    │ 4. example.com サーバーアドレスを返却\n                                    ▼\n                         example.com DNS\n                                    │\n                                    │ 5. www.example.com の IP を返却\n                                    ▼\n                          93.184.216.34 を返却\n</code></pre>\n<h3>再帰クエリ vs 反復クエリ</h3>\n<table>\n<thead>\n<tr>\n<th>タイプ</th>\n<th>説明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>再帰クエリ</strong></td>\n<td>クライアントが1回リクエスト、DNS サーバーが全クエリを完了</td>\n</tr>\n<tr>\n<td><strong>反復クエリ</strong></td>\n<td>DNS サーバーが次のクエリ先を返却、クライアントが継続クエリ</td>\n</tr>\n</tbody>\n</table>\n<h2>DNS ツール</h2>\n<h3>nslookup</h3>\n<pre><code class=\"language-bash\"># 基本クエリ\nnslookup example.com\n\n# DNS サーバーを指定\nnslookup example.com 8.8.8.8\n\n# 特定レコードをクエリ\nnslookup -type=MX example.com\nnslookup -type=TXT example.com\n</code></pre>\n<h3>dig</h3>\n<pre><code class=\"language-bash\"># 基本クエリ\ndig example.com\n\n# 簡潔な出力\ndig example.com +short\n\n# 特定レコードをクエリ\ndig example.com MX\ndig example.com TXT\ndig example.com NS\n\n# DNS サーバーを指定\ndig @8.8.8.8 example.com\n\n# 解決プロセスを追跡\ndig example.com +trace\n\n# 逆引き\ndig -x 93.184.216.34\n</code></pre>\n<h3>host</h3>\n<pre><code class=\"language-bash\"># 基本クエリ\nhost example.com\n\n# すべてのレコードをクエリ\nhost -a example.com\n\n# 逆引き\nhost 93.184.216.34\n</code></pre>\n<h2>DNS キャッシュ</h2>\n<h3>TTL (Time To Live)</h3>\n<pre><code class=\"language-dns\">example.com.  3600  IN  A  93.184.216.34\n              │\n              └── TTL: 3600 秒 (1 時間)\n</code></pre>\n<h3>ローカルキャッシュをクリア</h3>\n<pre><code class=\"language-bash\"># Linux (systemd-resolved)\nsudo systemd-resolve --flush-caches\n\n# macOS\nsudo dscacheutil -flushcache\nsudo killall -HUP mDNSResponder\n\n# Windows\nipconfig /flushdns\n</code></pre>\n<h2>ローカル DNS 設定</h2>\n<h3>/etc/hosts</h3>\n<pre><code class=\"language-bash\"># ローカルドメインマッピング\n127.0.0.1       localhost\n192.168.1.100   myserver.local\n192.168.1.101   db.local\n</code></pre>\n<h3>/etc/resolv.conf</h3>\n<pre><code class=\"language-bash\"># DNS サーバー設定\nnameserver 8.8.8.8\nnameserver 8.8.4.4\nsearch example.com\n</code></pre>\n<h2>よく使うパブリック DNS</h2>\n<table>\n<thead>\n<tr>\n<th>プロバイダー</th>\n<th>IPv4</th>\n<th>IPv6</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Google</td>\n<td>8.8.8.8, 8.8.4.4</td>\n<td>2001:4860:4860::8888</td>\n</tr>\n<tr>\n<td>Cloudflare</td>\n<td>1.1.1.1, 1.0.0.1</td>\n<td>2606:4700:4700::1111</td>\n</tr>\n<tr>\n<td>IIJ</td>\n<td>210.130.0.1</td>\n<td>-</td>\n</tr>\n</tbody>\n</table>\n<h2>DNS セキュリティ</h2>\n<h3>一般的な脅威</h3>\n<table>\n<thead>\n<tr>\n<th>脅威</th>\n<th>説明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>DNS ハイジャック</strong></td>\n<td>DNS レスポンスを改ざん、トラフィックをリダイレクト</td>\n</tr>\n<tr>\n<td><strong>DNS キャッシュポイズニング</strong></td>\n<td>偽の DNS レコードを注入</td>\n</tr>\n<tr>\n<td><strong>DDoS 攻撃</strong></td>\n<td>DNS 増幅攻撃を利用</td>\n</tr>\n</tbody>\n</table>\n<h3>セキュリティ対策</h3>\n<p><strong>DNSSEC</strong> - DNS セキュリティ拡張</p>\n<pre><code class=\"language-bash\"># DNSSEC を検証\ndig example.com +dnssec\n</code></pre>\n<p><strong>DoH</strong> - DNS over HTTPS</p>\n<pre><code>https://dns.google/dns-query\nhttps://cloudflare-dns.com/dns-query\n</code></pre>\n<p><strong>DoT</strong> - DNS over TLS</p>\n<pre><code>ポート 853\n</code></pre>\n<h2>トラブルシューティング</h2>\n<h3>よくある問題</h3>\n<pre><code class=\"language-bash\"># 1. DNS 解決を確認\ndig example.com\n\n# 2. ローカル設定を確認\ncat /etc/resolv.conf\n\n# 3. 異なる DNS サーバーでテスト\ndig @8.8.8.8 example.com\ndig @1.1.1.1 example.com\n\n# 4. キャッシュをクリアして再試行\nsudo systemd-resolve --flush-caches\n\n# 5. ネットワーク疎通を確認\nping 8.8.8.8\n</code></pre>\n<h2>まとめ</h2>\n<p>DNS はインターネットインフラの核心です：</p>\n<ol>\n<li><strong>階層構造</strong>: ルート → TLD → セカンドレベル → サブドメイン</li>\n<li><strong>レコードタイプ</strong>: A、AAAA、CNAME、MX、TXT など各々の用途</li>\n<li><strong>解決プロセス</strong>: 再帰/反復クエリ、段階的に検索</li>\n<li><strong>ツール活用</strong>: dig、nslookup、host</li>\n<li><strong>セキュリティ保護</strong>: DNSSEC、DoH、DoT</li>\n</ol>\n"
}