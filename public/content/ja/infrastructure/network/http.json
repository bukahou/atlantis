{
  "slug": "http",
  "meta": {
    "title": "HTTP プロトコル詳解",
    "description": "HTTP/HTTPS プロトコルの原理と実践を深く理解する",
    "order": 3,
    "tags": [
      "network",
      "http",
      "https",
      "web"
    ]
  },
  "content": "<h1>HTTP プロトコル詳解</h1>\n<h2>HTTP 基礎</h2>\n<p>HTTP (HyperText Transfer Protocol) は Web 通信の基盤プロトコルで、リクエスト-レスポンスモデルに基づいています。</p>\n<h3>HTTP バージョンの進化</h3>\n<table>\n<thead>\n<tr>\n<th>バージョン</th>\n<th>年</th>\n<th>特徴</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HTTP/0.9</td>\n<td>1991</td>\n<td>GET のみ対応、ヘッダーなし</td>\n</tr>\n<tr>\n<td>HTTP/1.0</td>\n<td>1996</td>\n<td>ヘッダー、ステータスコード、POST 導入</td>\n</tr>\n<tr>\n<td>HTTP/1.1</td>\n<td>1997</td>\n<td>持続的接続、パイプライン、Host ヘッダー</td>\n</tr>\n<tr>\n<td>HTTP/2</td>\n<td>2015</td>\n<td>多重化、ヘッダー圧縮、サーバープッシュ</td>\n</tr>\n<tr>\n<td>HTTP/3</td>\n<td>2022</td>\n<td>QUIC (UDP) ベース、より低レイテンシ</td>\n</tr>\n</tbody>\n</table>\n<h2>リクエストとレスポンス</h2>\n<h3>リクエスト構造</h3>\n<pre><code class=\"language-http\">GET /api/users HTTP/1.1\nHost: example.com\nUser-Agent: Mozilla/5.0\nAccept: application/json\nAuthorization: Bearer token123\nContent-Type: application/json\n\n{\"name\": \"John\"}\n</code></pre>\n<pre><code>┌─────────────────────────────────┐\n│ リクエストライン: メソッド パス プロトコル │\n├─────────────────────────────────┤\n│ リクエストヘッダー                │\n│ Host: example.com               │\n│ Content-Type: application/json  │\n├─────────────────────────────────┤\n│ 空行                             │\n├─────────────────────────────────┤\n│ リクエストボディ (オプション)      │\n└─────────────────────────────────┘\n</code></pre>\n<h3>レスポンス構造</h3>\n<pre><code class=\"language-http\">HTTP/1.1 200 OK\nContent-Type: application/json\nContent-Length: 27\nCache-Control: max-age=3600\n\n{\"id\": 1, \"name\": \"John\"}\n</code></pre>\n<pre><code>┌─────────────────────────────────┐\n│ ステータスライン: プロトコル コード 説明 │\n├─────────────────────────────────┤\n│ レスポンスヘッダー                │\n│ Content-Type: application/json  │\n│ Content-Length: 27              │\n├─────────────────────────────────┤\n│ 空行                             │\n├─────────────────────────────────┤\n│ レスポンスボディ                  │\n└─────────────────────────────────┘\n</code></pre>\n<h2>HTTP メソッド</h2>\n<table>\n<thead>\n<tr>\n<th>メソッド</th>\n<th>用途</th>\n<th>冪等</th>\n<th>安全</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>GET</strong></td>\n<td>リソース取得</td>\n<td>はい</td>\n<td>はい</td>\n</tr>\n<tr>\n<td><strong>POST</strong></td>\n<td>リソース作成</td>\n<td>いいえ</td>\n<td>いいえ</td>\n</tr>\n<tr>\n<td><strong>PUT</strong></td>\n<td>リソース置換</td>\n<td>はい</td>\n<td>いいえ</td>\n</tr>\n<tr>\n<td><strong>PATCH</strong></td>\n<td>部分更新</td>\n<td>いいえ</td>\n<td>いいえ</td>\n</tr>\n<tr>\n<td><strong>DELETE</strong></td>\n<td>リソース削除</td>\n<td>はい</td>\n<td>いいえ</td>\n</tr>\n<tr>\n<td><strong>HEAD</strong></td>\n<td>ヘッダー取得</td>\n<td>はい</td>\n<td>はい</td>\n</tr>\n<tr>\n<td><strong>OPTIONS</strong></td>\n<td>対応メソッド確認</td>\n<td>はい</td>\n<td>はい</td>\n</tr>\n</tbody>\n</table>\n<h3>RESTful 例</h3>\n<pre><code class=\"language-bash\"># ユーザー一覧を取得\nGET /api/users\n\n# 単一ユーザーを取得\nGET /api/users/123\n\n# ユーザーを作成\nPOST /api/users\nContent-Type: application/json\n{\"name\": \"John\", \"email\": \"john@example.com\"}\n\n# ユーザーを更新\nPUT /api/users/123\nContent-Type: application/json\n{\"name\": \"John Doe\", \"email\": \"john@example.com\"}\n\n# ユーザーを削除\nDELETE /api/users/123\n</code></pre>\n<h2>ステータスコード</h2>\n<h3>分類</h3>\n<table>\n<thead>\n<tr>\n<th>範囲</th>\n<th>カテゴリ</th>\n<th>説明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1xx</td>\n<td>情報</td>\n<td>リクエスト受信、処理継続</td>\n</tr>\n<tr>\n<td>2xx</td>\n<td>成功</td>\n<td>リクエスト正常処理</td>\n</tr>\n<tr>\n<td>3xx</td>\n<td>リダイレクト</td>\n<td>追加操作が必要</td>\n</tr>\n<tr>\n<td>4xx</td>\n<td>クライアントエラー</td>\n<td>リクエストに問題</td>\n</tr>\n<tr>\n<td>5xx</td>\n<td>サーバーエラー</td>\n<td>サーバー処理失敗</td>\n</tr>\n</tbody>\n</table>\n<h3>よく使うステータスコード</h3>\n<pre><code>200 OK                    リクエスト成功\n201 Created               リソース作成成功\n204 No Content            成功だが返却内容なし\n\n301 Moved Permanently     恒久リダイレクト\n302 Found                 一時リダイレクト\n304 Not Modified          リソース未変更 (キャッシュ有効)\n\n400 Bad Request           リクエスト構文エラー\n401 Unauthorized          未認証\n403 Forbidden             アクセス禁止\n404 Not Found             リソースが存在しない\n405 Method Not Allowed    メソッド不許可\n429 Too Many Requests     リクエスト過多\n\n500 Internal Server Error サーバー内部エラー\n502 Bad Gateway           ゲートウェイエラー\n503 Service Unavailable   サービス利用不可\n504 Gateway Timeout       ゲートウェイタイムアウト\n</code></pre>\n<h2>よく使うヘッダー</h2>\n<h3>リクエストヘッダー</h3>\n<table>\n<thead>\n<tr>\n<th>ヘッダー</th>\n<th>説明</th>\n<th>例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Host</code></td>\n<td>対象ホスト</td>\n<td><code>example.com</code></td>\n</tr>\n<tr>\n<td><code>User-Agent</code></td>\n<td>クライアント識別</td>\n<td><code>Mozilla/5.0...</code></td>\n</tr>\n<tr>\n<td><code>Accept</code></td>\n<td>受け入れコンテンツタイプ</td>\n<td><code>application/json</code></td>\n</tr>\n<tr>\n<td><code>Content-Type</code></td>\n<td>リクエストボディタイプ</td>\n<td><code>application/json</code></td>\n</tr>\n<tr>\n<td><code>Authorization</code></td>\n<td>認証情報</td>\n<td><code>Bearer token123</code></td>\n</tr>\n<tr>\n<td><code>Cookie</code></td>\n<td>Cookie データ</td>\n<td><code>session=abc123</code></td>\n</tr>\n<tr>\n<td><code>Cache-Control</code></td>\n<td>キャッシュ制御</td>\n<td><code>no-cache</code></td>\n</tr>\n</tbody>\n</table>\n<h3>レスポンスヘッダー</h3>\n<table>\n<thead>\n<tr>\n<th>ヘッダー</th>\n<th>説明</th>\n<th>例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>Content-Type</code></td>\n<td>レスポンスボディタイプ</td>\n<td><code>text/html; charset=utf-8</code></td>\n</tr>\n<tr>\n<td><code>Content-Length</code></td>\n<td>レスポンスボディ長</td>\n<td><code>1234</code></td>\n</tr>\n<tr>\n<td><code>Set-Cookie</code></td>\n<td>Cookie 設定</td>\n<td><code>session=abc; HttpOnly</code></td>\n</tr>\n<tr>\n<td><code>Cache-Control</code></td>\n<td>キャッシュ制御</td>\n<td><code>max-age=3600</code></td>\n</tr>\n<tr>\n<td><code>Location</code></td>\n<td>リダイレクト先</td>\n<td><code>https://new.example.com</code></td>\n</tr>\n<tr>\n<td><code>Access-Control-*</code></td>\n<td>CORS 関連</td>\n<td><code>Access-Control-Allow-Origin: *</code></td>\n</tr>\n</tbody>\n</table>\n<h2>キャッシュメカニズム</h2>\n<h3>キャッシュ制御</h3>\n<pre><code class=\"language-http\"># レスポンスを 1 時間キャッシュ可能\nCache-Control: max-age=3600\n\n# キャッシュ禁止\nCache-Control: no-store\n\n# 毎回検証が必要\nCache-Control: no-cache\n\n# プライベートキャッシュ (ブラウザのみ)\nCache-Control: private, max-age=3600\n\n# パブリックキャッシュ (CDN も可)\nCache-Control: public, max-age=86400\n</code></pre>\n<h3>条件付きリクエスト</h3>\n<pre><code class=\"language-http\"># サーバーが返却\nETag: \"abc123\"\nLast-Modified: Wed, 01 Jan 2024 00:00:00 GMT\n\n# クライアントが検証\nIf-None-Match: \"abc123\"\nIf-Modified-Since: Wed, 01 Jan 2024 00:00:00 GMT\n\n# 未変更なら 304 を返却\nHTTP/1.1 304 Not Modified\n</code></pre>\n<h2>HTTPS</h2>\n<h3>TLS ハンドシェイク</h3>\n<pre><code>クライアント                      サーバー\n   │                              │\n   │  ──── Client Hello ────────> │  対応暗号スイート\n   │                              │\n   │  &#x3C;─── Server Hello ───────── │  暗号スイート選択\n   │  &#x3C;─── Certificate ────────── │  サーバー証明書\n   │  &#x3C;─── Server Hello Done ──── │\n   │                              │\n   │  ──── Key Exchange ────────> │  鍵交換\n   │  ──── Change Cipher Spec ──> │\n   │  ──── Finished ────────────> │\n   │                              │\n   │  &#x3C;─── Change Cipher Spec ─── │\n   │  &#x3C;─── Finished ───────────── │\n   │                              │\n   │      暗号化通信開始            │\n</code></pre>\n<h3>証明書設定 (Nginx)</h3>\n<pre><code class=\"language-nginx\">server {\n    listen 443 ssl http2;\n    server_name example.com;\n\n    ssl_certificate     /etc/ssl/certs/example.com.crt;\n    ssl_certificate_key /etc/ssl/private/example.com.key;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;\n    ssl_prefer_server_ciphers on;\n\n    # HSTS\n    add_header Strict-Transport-Security \"max-age=31536000\" always;\n}\n</code></pre>\n<h2>CORS クロスオリジン</h2>\n<h3>単純リクエスト</h3>\n<pre><code class=\"language-http\"># リクエスト\nGET /api/data HTTP/1.1\nOrigin: https://example.com\n\n# レスポンス\nAccess-Control-Allow-Origin: https://example.com\n</code></pre>\n<h3>プリフライトリクエスト</h3>\n<pre><code class=\"language-http\"># プリフライトリクエスト\nOPTIONS /api/data HTTP/1.1\nOrigin: https://example.com\nAccess-Control-Request-Method: POST\nAccess-Control-Request-Headers: Content-Type\n\n# プリフライトレスポンス\nAccess-Control-Allow-Origin: https://example.com\nAccess-Control-Allow-Methods: GET, POST, PUT, DELETE\nAccess-Control-Allow-Headers: Content-Type\nAccess-Control-Max-Age: 86400\n</code></pre>\n<h2>デバッグツール</h2>\n<h3>curl</h3>\n<pre><code class=\"language-bash\"># GET リクエスト\ncurl https://api.example.com/users\n\n# POST リクエスト\ncurl -X POST https://api.example.com/users \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"John\"}'\n\n# レスポンスヘッダーを表示\ncurl -I https://example.com\n\n# 詳細出力\ncurl -v https://example.com\n\n# リダイレクトを追跡\ncurl -L https://example.com\n</code></pre>\n<h3>ブラウザ開発者ツール</h3>\n<ul>\n<li><strong>Network パネル</strong>: すべてのリクエストを表示</li>\n<li><strong>Headers</strong>: リクエスト/レスポンスヘッダー</li>\n<li><strong>Preview/Response</strong>: レスポンス内容</li>\n<li><strong>Timing</strong>: リクエスト時間分析</li>\n</ul>\n<h2>まとめ</h2>\n<p>HTTP プロトコルの核心ポイント：</p>\n<ol>\n<li><strong>リクエストメソッド</strong>: GET、POST、PUT、DELETE それぞれに意味がある</li>\n<li><strong>ステータスコード</strong>: 適切なステータスコードで結果を表現</li>\n<li><strong>ヘッダー</strong>: キャッシュ、認証、コンテンツネゴシエーションを制御</li>\n<li><strong>HTTPS</strong>: TLS 暗号化で通信を保護</li>\n<li><strong>CORS</strong>: クロスオリジンリソース共有メカニズム</li>\n</ol>\n"
}