{
  "slug": "storage",
  "meta": {
    "title": "ストレージ管理",
    "description": "Linux ストレージ：ファイルシステム、ディスク管理と I/O スケジューリング",
    "order": 4,
    "tags": [
      "Linux",
      "ストレージ",
      "ファイルシステム",
      "LVM"
    ]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コアコンセプト",
      "items": [
        "VFS 仮想ファイルシステムが統一インターフェースを提供",
        "ブロックデバイスはパーティションとファイルシステムで構成",
        "LVM は柔軟なボリューム管理を提供",
        "I/O スケジューラがディスクアクセス性能を最適化"
      ]
    },
    {
      "type": "flow",
      "title": "ストレージ階層構造",
      "direction": "vertical",
      "steps": [
        {
          "label": "アプリケーション",
          "description": "read/write",
          "color": "bg-blue-500"
        },
        {
          "label": "VFS",
          "description": "仮想ファイルシステム",
          "color": "bg-cyan-500"
        },
        {
          "label": "ファイルシステム",
          "description": "ext4/xfs/btrfs",
          "color": "bg-purple-500"
        },
        {
          "label": "ブロック層",
          "description": "I/O スケジューリング",
          "color": "bg-amber-500"
        },
        {
          "label": "デバイスドライバ",
          "description": "SCSI/NVMe",
          "color": "bg-orange-500"
        },
        {
          "label": "ハードウェア",
          "description": "HDD/SSD",
          "color": "bg-gray-500"
        }
      ]
    },
    {
      "type": "cards",
      "title": "主要ファイルシステム",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "ext4",
          "badge": "デフォルト",
          "badgeColor": "green",
          "points": [
            "Linux デフォルトファイルシステム",
            "ジャーナリング機能、高信頼性",
            "最大 1EB ボリューム/16TB ファイル",
            "成熟して安定"
          ]
        },
        {
          "title": "XFS",
          "badge": "高性能",
          "badgeColor": "blue",
          "points": [
            "RHEL デフォルト",
            "大ファイルで高性能",
            "オンライン拡張対応",
            "遅延割り当て"
          ]
        },
        {
          "title": "Btrfs",
          "badge": "高機能",
          "badgeColor": "purple",
          "points": [
            "コピーオンライト (CoW)",
            "スナップショット/サブボリューム",
            "組み込み RAID",
            "データチェックサム"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "ディスクとパーティション管理",
      "language": "bash",
      "code": "# ディスク確認\nlsblk                     # ブロックデバイス一覧\nfdisk -l                  # ディスク詳細\nblkid                     # パーティション UUID\n\n# パーティションツール\nfdisk /dev/sdb            # MBR パーティション\ngdisk /dev/sdb            # GPT パーティション\nparted /dev/sdb           # 汎用ツール\n\n# ファイルシステム作成\nmkfs.ext4 /dev/sdb1\nmkfs.xfs /dev/sdb2\nmkfs.btrfs /dev/sdb3\n\n# マウント\nmount /dev/sdb1 /mnt/data\numount /mnt/data\n\n# 永続マウント (/etc/fstab)\nUUID=xxx /mnt/data ext4 defaults 0 2"
    },
    {
      "type": "table",
      "title": "MBR vs GPT",
      "highlightFirst": true,
      "headers": [
        "特性",
        "MBR",
        "GPT"
      ],
      "rows": [
        [
          "最大ディスク",
          "2TB",
          "9.4ZB"
        ],
        [
          "パーティション数",
          "4 プライマリ",
          "128 パーティション"
        ],
        [
          "ブート方式",
          "BIOS",
          "UEFI"
        ],
        [
          "データ冗長性",
          "なし",
          "バックアップテーブルあり"
        ],
        [
          "現代システム",
          "レガシー互換",
          "推奨"
        ]
      ]
    },
    {
      "type": "cards",
      "title": "LVM 論理ボリューム管理",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "PV 物理ボリューム",
          "badge": "下層",
          "badgeColor": "gray",
          "points": [
            "物理パーティションまたはディスク",
            "pvcreate で作成",
            "pvdisplay で確認"
          ]
        },
        {
          "title": "VG ボリュームグループ",
          "badge": "プール",
          "badgeColor": "blue",
          "points": [
            "PV の集合",
            "vgcreate で作成",
            "動的拡張可能"
          ]
        },
        {
          "title": "LV 論理ボリューム",
          "badge": "使用",
          "badgeColor": "green",
          "points": [
            "実際に使用するボリューム",
            "lvcreate で作成",
            "サイズ変更可能"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "LVM 操作",
      "language": "bash",
      "code": "# LVM 作成\npvcreate /dev/sdb1 /dev/sdc1        # PV 作成\nvgcreate vg_data /dev/sdb1 /dev/sdc1 # VG 作成\nlvcreate -L 100G -n lv_app vg_data   # LV 作成\n\n# フォーマットとマウント\nmkfs.xfs /dev/vg_data/lv_app\nmount /dev/vg_data/lv_app /app\n\n# LV 拡張\nlvextend -L +50G /dev/vg_data/lv_app\nresize2fs /dev/vg_data/lv_app  # ext4\nxfs_growfs /app                 # xfs\n\n# LVM 確認\npvs  # PV 概要\nvgs  # VG 概要\nlvs  # LV 概要"
    },
    {
      "type": "comparison",
      "title": "I/O スケジューラ",
      "columns": [
        {
          "title": "mq-deadline",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            {
              "label": "適用",
              "description": "HDD/汎用"
            },
            {
              "label": "特徴",
              "description": "リクエスト遅延を保証"
            },
            {
              "label": "戦略",
              "description": "読み取り優先、書き込みバッチ"
            }
          ]
        },
        {
          "title": "bfq",
          "color": "from-green-500 to-emerald-500",
          "items": [
            {
              "label": "適用",
              "description": "デスクトップ/インタラクティブ"
            },
            {
              "label": "特徴",
              "description": "低遅延レスポンス"
            },
            {
              "label": "戦略",
              "description": "公平な帯域幅分配"
            }
          ]
        },
        {
          "title": "none/noop",
          "color": "from-amber-500 to-orange-500",
          "items": [
            {
              "label": "適用",
              "description": "SSD/NVMe"
            },
            {
              "label": "特徴",
              "description": "最小オーバーヘッド"
            },
            {
              "label": "戦略",
              "description": "FIFO シンプルキュー"
            }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "I/O 監視とチューニング",
      "language": "bash",
      "code": "# I/O 監視\niostat -x 1 5              # ディスク I/O 統計\niotop                      # プロセス I/O リアルタイム\n\n# スケジューラ確認/設定\ncat /sys/block/sda/queue/scheduler\necho mq-deadline > /sys/block/sda/queue/scheduler\n\n# キュー深度確認\ncat /sys/block/sda/queue/nr_requests\n\n# ディスク性能テスト\ndd if=/dev/zero of=test bs=1G count=1 oflag=direct\nfio --name=randread --ioengine=libaio --direct=1 \\\n    --bs=4k --iodepth=32 --size=1G --rw=randread"
    },
    {
      "type": "table",
      "title": "重要ディレクトリの説明",
      "highlightFirst": true,
      "headers": [
        "ディレクトリ",
        "用途"
      ],
      "rows": [
        [
          "/",
          "ルートディレクトリ"
        ],
        [
          "/boot",
          "ブートファイル、カーネル"
        ],
        [
          "/home",
          "ユーザーホームディレクトリ"
        ],
        [
          "/var",
          "可変データ、ログ"
        ],
        [
          "/tmp",
          "一時ファイル"
        ],
        [
          "/opt",
          "サードパーティソフトウェア"
        ],
        [
          "/mnt",
          "一時マウントポイント"
        ]
      ]
    },
    {
      "type": "list",
      "title": "ストレージのベストプラクティス",
      "style": "check",
      "items": [
        {
          "label": "LVM を使用",
          "description": "拡張と管理が容易"
        },
        {
          "label": "SSD は none スケジューラ",
          "description": "不要なオーバーヘッドを削減"
        },
        {
          "label": "/var を独立パーティションに",
          "description": "ログでルートパーティションが満杯になるのを防止"
        },
        {
          "label": "定期的な I/O 監視",
          "description": "性能ボトルネックを特定"
        }
      ]
    }
  ],
  "relatedTopics": [
    "Linux カーネル",
    "パフォーマンスチューニング",
    "高可用性"
  ]
}