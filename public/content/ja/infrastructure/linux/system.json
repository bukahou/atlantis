{
  "slug": "system",
  "meta": {
    "title": "Linux システム管理",
    "description": "Linux システム管理の核心知識と一般的な操作",
    "order": 2,
    "tags": [
      "linux",
      "system",
      "admin"
    ]
  },
  "content": "<h1>Linux システム管理</h1>\n<h2>ユーザーと権限</h2>\n<h3>ユーザー管理</h3>\n<pre><code class=\"language-bash\"># ユーザーを追加\nuseradd -m -s /bin/bash username\nuseradd -m -G sudo,docker username  # 追加グループを指定\n\n# パスワードを設定\npasswd username\n\n# ユーザーを変更\nusermod -aG docker username   # グループに追加\nusermod -s /bin/zsh username  # シェルを変更\n\n# ユーザーを削除\nuserdel username\nuserdel -r username           # ホームディレクトリも削除\n</code></pre>\n<h3>グループ管理</h3>\n<pre><code class=\"language-bash\"># グループを作成\ngroupadd developers\n\n# グループを確認\ngroups username\ncat /etc/group\n\n# グループを削除\ngroupdel developers\n</code></pre>\n<h3>ファイル権限</h3>\n<pre><code>-rwxr-xr-- 1 user group 1024 Jan 1 00:00 file.txt\n│└┬┘└┬┘└┬┘\n│ │  │  └── その他: r-- (読み取り)\n│ │  └───── グループ: r-x (読み取り+実行)\n│ └──────── 所有者: rwx (読み取り+書き込み+実行)\n└────────── ファイルタイプ: - 通常ファイル, d ディレクトリ, l リンク\n</code></pre>\n<h3>権限操作</h3>\n<pre><code class=\"language-bash\"># 数字モード\nchmod 755 file.txt    # rwxr-xr-x\nchmod 644 file.txt    # rw-r--r--\n\n# シンボリックモード\nchmod u+x file.txt    # 所有者に実行を追加\nchmod g-w file.txt    # グループから書き込みを削除\nchmod o=r file.txt    # その他は読み取りのみ\nchmod a+r file.txt    # 全員に読み取りを追加\n\n# 再帰的に変更\nchmod -R 755 directory/\n\n# 所有者を変更\nchown user:group file.txt\nchown -R user:group directory/\n</code></pre>\n<h3>特殊権限</h3>\n<pre><code class=\"language-bash\"># SUID (4): ファイル所有者として実行\nchmod u+s /usr/bin/passwd\nchmod 4755 executable\n\n# SGID (2): ファイルのグループとして実行\nchmod g+s directory/\nchmod 2755 directory/\n\n# Sticky Bit (1): 所有者のみ削除可能\nchmod +t /tmp\nchmod 1777 /tmp\n</code></pre>\n<h2>プロセス管理</h2>\n<h3>プロセスを確認</h3>\n<pre><code class=\"language-bash\"># よく使う ps コマンド\nps aux                 # すべてのプロセス詳細\nps -ef                 # 完全フォーマット\nps -u username         # 指定ユーザーのプロセス\n\n# top リアルタイム監視\ntop\nhtop                   # 拡張版 (インストール必要)\n\n# リソースでソート\nps aux --sort=-%mem    # メモリ順\nps aux --sort=-%cpu    # CPU 順\n</code></pre>\n<h3>プロセス制御</h3>\n<pre><code class=\"language-bash\"># シグナルを送信\nkill PID               # デフォルト SIGTERM (15)\nkill -9 PID            # SIGKILL 強制終了\nkill -HUP PID          # SIGHUP 設定再読み込み\n\n# 名前で終了\npkill nginx\nkillall nginx\n\n# バックグラウンド実行\ncommand &#x26;              # バックグラウンドで実行\nnohup command &#x26;        # ハングアップシグナルを無視\ndisown %1              # ジョブリストから削除\n\n# ジョブ制御\njobs                   # ジョブを確認\nfg %1                  # フォアグラウンドで実行\nbg %1                  # バックグラウンドで実行\nCtrl+Z                 # 現在のプロセスを一時停止\n</code></pre>\n<h2>サービス管理 (systemd)</h2>\n<h3>基本操作</h3>\n<pre><code class=\"language-bash\"># サービス状態\nsystemctl status nginx\nsystemctl is-active nginx\nsystemctl is-enabled nginx\n\n# サービスの起動停止\nsystemctl start nginx\nsystemctl stop nginx\nsystemctl restart nginx\nsystemctl reload nginx    # 設定を再読み込み\n\n# 自動起動\nsystemctl enable nginx\nsystemctl disable nginx\n</code></pre>\n<h3>ログを確認</h3>\n<pre><code class=\"language-bash\"># サービスログを確認\njournalctl -u nginx\njournalctl -u nginx -f        # 継続出力\njournalctl -u nginx --since today\njournalctl -u nginx -n 100    # 最後の 100 行\n</code></pre>\n<h3>サービスユニットファイル</h3>\n<pre><code class=\"language-ini\"># /etc/systemd/system/myapp.service\n\n[Unit]\nDescription=My Application\nAfter=network.target\n\n[Service]\nType=simple\nUser=appuser\nWorkingDirectory=/opt/myapp\nExecStart=/opt/myapp/bin/start.sh\nExecStop=/opt/myapp/bin/stop.sh\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n<pre><code class=\"language-bash\"># 設定を再読み込み\nsystemctl daemon-reload\n</code></pre>\n<h2>ディスク管理</h2>\n<h3>ディスクを確認</h3>\n<pre><code class=\"language-bash\"># ディスク使用量\ndf -h                  # ファイルシステム使用率\ndf -i                  # inode 使用率\n\n# ディレクトリサイズ\ndu -sh /var/log        # 単一ディレクトリ\ndu -sh /*              # ルートの各サブディレクトリ\ndu -h --max-depth=1    # 1階層のサブディレクトリ\n\n# ブロックデバイスを確認\nlsblk\nfdisk -l\n</code></pre>\n<h3>マウント操作</h3>\n<pre><code class=\"language-bash\"># マウント\nmount /dev/sdb1 /mnt/data\nmount -t nfs server:/share /mnt/nfs\n\n# アンマウント\numount /mnt/data\numount -l /mnt/data    # 遅延アンマウント\n\n# マウントを確認\nmount | grep sdb\ncat /etc/mtab\n</code></pre>\n<h3>永続マウント (/etc/fstab)</h3>\n<pre><code># &#x3C;デバイス>    &#x3C;マウントポイント> &#x3C;タイプ> &#x3C;オプション>      &#x3C;dump> &#x3C;pass>\n/dev/sdb1      /mnt/data        ext4    defaults          0      2\nUUID=xxx-xxx   /mnt/backup      ext4    defaults,noatime  0      2\n</code></pre>\n<h2>ネットワーク設定</h2>\n<h3>ネットワークを確認</h3>\n<pre><code class=\"language-bash\"># IP アドレス\nip addr\nip a\n\n# ルーティングテーブル\nip route\nroute -n\n\n# ネットワーク接続\nss -tuln           # リスニングポート\nss -tunp           # プロセス情報を含む\n</code></pre>\n<h3>ネットワーク設定 (Netplan - Ubuntu)</h3>\n<pre><code class=\"language-yaml\"># /etc/netplan/01-config.yaml\n\nnetwork:\n  version: 2\n  ethernets:\n    eth0:\n      dhcp4: false\n      addresses:\n        - 192.168.1.100/24\n      gateway4: 192.168.1.1\n      nameservers:\n        addresses:\n          - 8.8.8.8\n          - 8.8.4.4\n</code></pre>\n<pre><code class=\"language-bash\"># 設定を適用\nnetplan apply\n</code></pre>\n<h3>ファイアウォール (ufw)</h3>\n<pre><code class=\"language-bash\"># 有効/無効\nufw enable\nufw disable\n\n# ルール管理\nufw allow 22\nufw allow 80/tcp\nufw allow from 192.168.1.0/24\nufw deny 3306\n\n# 状態を確認\nufw status\nufw status verbose\n</code></pre>\n<h2>ログ管理</h2>\n<h3>システムログ</h3>\n<pre><code class=\"language-bash\"># よく使うログ\n/var/log/syslog        # システムログ\n/var/log/auth.log      # 認証ログ\n/var/log/kern.log      # カーネルログ\n/var/log/dmesg         # 起動ログ\n\n# ログを確認\ntail -f /var/log/syslog\nless /var/log/auth.log\ngrep \"error\" /var/log/syslog\n</code></pre>\n<h3>journalctl</h3>\n<pre><code class=\"language-bash\"># 時間でフィルタ\njournalctl --since \"2024-01-01\"\njournalctl --since \"1 hour ago\"\njournalctl --since today\n\n# 優先度で\njournalctl -p err      # エラー以上\njournalctl -p warning\n\n# ディスク使用量\njournalctl --disk-usage\njournalctl --vacuum-size=100M\n</code></pre>\n<h2>定期タスク</h2>\n<h3>crontab</h3>\n<pre><code class=\"language-bash\"># 定期タスクを編集\ncrontab -e\n\n# タスクを確認\ncrontab -l\n\n# フォーマット: 分 時 日 月 曜日 コマンド\n# ┌───────── 分 (0-59)\n# │ ┌─────── 時 (0-23)\n# │ │ ┌───── 日 (1-31)\n# │ │ │ ┌─── 月 (1-12)\n# │ │ │ │ ┌─ 曜日 (0-7, 0と7は日曜日)\n# * * * * * command\n\n# 例\n0 2 * * * /scripts/backup.sh       # 毎日 2:00\n*/5 * * * * /scripts/check.sh      # 5分ごと\n0 0 * * 0 /scripts/weekly.sh       # 毎週日曜 00:00\n</code></pre>\n<h3>systemd timer</h3>\n<pre><code class=\"language-ini\"># /etc/systemd/system/backup.timer\n\n[Unit]\nDescription=Daily backup timer\n\n[Timer]\nOnCalendar=*-*-* 02:00:00\nPersistent=true\n\n[Install]\nWantedBy=timers.target\n</code></pre>\n<pre><code class=\"language-bash\">systemctl enable backup.timer\nsystemctl start backup.timer\nsystemctl list-timers\n</code></pre>\n<h2>まとめ</h2>\n<p>Linux システム管理の核心スキル：</p>\n<ol>\n<li><strong>ユーザー権限</strong>: 適切に権限を割り当て、最小権限の原則に従う</li>\n<li><strong>プロセス管理</strong>: リソースを監視し、異常プロセスを迅速に処理</li>\n<li><strong>サービス管理</strong>: systemd を使いこなす</li>\n<li><strong>ディスクとネットワーク</strong>: 定期的にチェックし、問題を予防</li>\n<li><strong>ログ分析</strong>: 問題の根本原因を素早く特定</li>\n</ol>\n"
}