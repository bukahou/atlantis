{
  "slug": "azure",
  "meta": {
    "title": "Azure クラウドサービス基礎",
    "description": "Microsoft Azure コアサービスの紹介と実践ガイド",
    "order": 3,
    "tags": [
      "azure",
      "cloud",
      "vm",
      "blob-storage"
    ]
  },
  "content": "<h1>Azure クラウドサービス基礎</h1>\n<h2>Azure とは</h2>\n<p>Microsoft Azure は、Microsoft が提供するクラウドコンピューティングプラットフォームで、Microsoft エコシステムと深く統合され、200以上のクラウドサービスを提供しています。</p>\n<pre><code>Azure グローバルインフラストラクチャ\n├── Regions (リージョン) - 60+\n│   └── Availability Zones (可用性ゾーン) - 各リージョン3つ\n├── Edge Zones\n└── Azure CDN PoPs - グローバル分散\n</code></pre>\n<h2>コアコンピューティングサービス</h2>\n<h3>Virtual Machines (仮想マシン)</h3>\n<p>Azure VM は、様々なサイズの仮想マシンインスタンスを提供します。</p>\n<h4>VM シリーズ</h4>\n<table>\n<thead>\n<tr>\n<th>シリーズ</th>\n<th>用途</th>\n<th>特徴</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>B</strong></td>\n<td>バースト型</td>\n<td>コスト効率、可変CPU</td>\n</tr>\n<tr>\n<td><strong>D</strong></td>\n<td>汎用</td>\n<td>CPU/メモリバランス</td>\n</tr>\n<tr>\n<td><strong>E</strong></td>\n<td>メモリ最適化</td>\n<td>高メモリ比</td>\n</tr>\n<tr>\n<td><strong>F</strong></td>\n<td>コンピューティング最適化</td>\n<td>高CPU性能</td>\n</tr>\n<tr>\n<td><strong>N</strong></td>\n<td>GPU</td>\n<td>AI/ML ワークロード</td>\n</tr>\n<tr>\n<td><strong>L</strong></td>\n<td>ストレージ最適化</td>\n<td>高スループット</td>\n</tr>\n</tbody>\n</table>\n<h4>VM の作成</h4>\n<pre><code class=\"language-bash\"># Azure CLI で VM を作成\naz vm create \\\n  --resource-group myResourceGroup \\\n  --name myVM \\\n  --image Ubuntu2204 \\\n  --size Standard_B2s \\\n  --admin-username azureuser \\\n  --generate-ssh-keys \\\n  --public-ip-sku Standard\n\n# マネージドディスク付き VM の作成\naz vm create \\\n  --resource-group myResourceGroup \\\n  --name myVM \\\n  --image Win2022Datacenter \\\n  --size Standard_D4s_v3 \\\n  --admin-username azureuser \\\n  --admin-password MyPassword123! \\\n  --os-disk-size-gb 128 \\\n  --data-disk-sizes-gb 256\n</code></pre>\n<h4>Virtual Machine Scale Sets</h4>\n<pre><code class=\"language-bash\"># スケールセットの作成\naz vmss create \\\n  --resource-group myResourceGroup \\\n  --name myScaleSet \\\n  --image Ubuntu2204 \\\n  --instance-count 3 \\\n  --vm-sku Standard_B2s \\\n  --admin-username azureuser \\\n  --generate-ssh-keys \\\n  --upgrade-policy-mode automatic\n\n# 自動スケーリングの設定\naz monitor autoscale create \\\n  --resource-group myResourceGroup \\\n  --resource myScaleSet \\\n  --resource-type Microsoft.Compute/virtualMachineScaleSets \\\n  --min-count 2 \\\n  --max-count 10 \\\n  --count 3\n\naz monitor autoscale rule create \\\n  --resource-group myResourceGroup \\\n  --autoscale-name myScaleSet-autoscale \\\n  --scale out 1 \\\n  --condition \"Percentage CPU > 75 avg 5m\"\n</code></pre>\n<h3>Azure Functions (サーバーレス)</h3>\n<pre><code class=\"language-python\"># function_app.py - Azure Functions の例\nimport azure.functions as func\nimport json\n\napp = func.FunctionApp()\n\n@app.route(route=\"hello\", methods=[\"GET\"])\ndef hello(req: func.HttpRequest) -> func.HttpResponse:\n    name = req.params.get('name', 'World')\n    return func.HttpResponse(f\"Hello, {name}!\")\n\n@app.blob_trigger(arg_name=\"blob\", path=\"container/{name}\",\n                  connection=\"AzureWebJobsStorage\")\ndef blob_trigger(blob: func.InputStream):\n    print(f\"Blob trigger: {blob.name}, Size: {blob.length}\")\n</code></pre>\n<pre><code class=\"language-bash\"># Function App の作成\naz functionapp create \\\n  --resource-group myResourceGroup \\\n  --name myFunctionApp \\\n  --storage-account mystorageaccount \\\n  --consumption-plan-location eastasia \\\n  --runtime python \\\n  --runtime-version 3.11 \\\n  --functions-version 4\n\n# 関数のデプロイ\nfunc azure functionapp publish myFunctionApp\n</code></pre>\n<h3>Azure Container Instances (ACI)</h3>\n<pre><code class=\"language-bash\"># コンテナの実行\naz container create \\\n  --resource-group myResourceGroup \\\n  --name mycontainer \\\n  --image nginx:latest \\\n  --ports 80 \\\n  --dns-name-label myapp \\\n  --cpu 1 \\\n  --memory 1.5\n\n# ログの表示\naz container logs --resource-group myResourceGroup --name mycontainer\n</code></pre>\n<h2>ストレージサービス</h2>\n<h3>Blob Storage</h3>\n<p>Azure Blob は、非構造化データを格納するためのオブジェクトストレージです。</p>\n<pre><code>アクセス層\n├── Hot - 頻繁にアクセスするデータ\n├── Cool - アクセス頻度が低い（最低30日）\n├── Cold - まれにアクセス（最低90日）\n└── Archive - アーカイブデータ（最低180日）\n</code></pre>\n<h4>操作例</h4>\n<pre><code class=\"language-bash\"># ストレージアカウントの作成\naz storage account create \\\n  --name mystorageaccount \\\n  --resource-group myResourceGroup \\\n  --location eastasia \\\n  --sku Standard_LRS\n\n# コンテナの作成\naz storage container create \\\n  --name mycontainer \\\n  --account-name mystorageaccount\n\n# ファイルのアップロード\naz storage blob upload \\\n  --account-name mystorageaccount \\\n  --container-name mycontainer \\\n  --name myblob \\\n  --file ./localfile.txt\n\n# 一括アップロード\naz storage blob upload-batch \\\n  --account-name mystorageaccount \\\n  --destination mycontainer \\\n  --source ./local-dir\n</code></pre>\n<pre><code class=\"language-python\"># Python SDK\nfrom azure.storage.blob import BlobServiceClient\n\nconnection_string = \"DefaultEndpointsProtocol=https;...\"\nblob_service = BlobServiceClient.from_connection_string(connection_string)\n\n# アップロード\ncontainer_client = blob_service.get_container_client(\"mycontainer\")\nwith open(\"file.txt\", \"rb\") as data:\n    container_client.upload_blob(name=\"file.txt\", data=data)\n\n# ダウンロード\nblob_client = container_client.get_blob_client(\"file.txt\")\nwith open(\"downloaded.txt\", \"wb\") as f:\n    f.write(blob_client.download_blob().readall())\n</code></pre>\n<h3>Azure Files</h3>\n<pre><code class=\"language-bash\"># ファイル共有の作成\naz storage share create \\\n  --name myshare \\\n  --account-name mystorageaccount \\\n  --quota 100\n\n# Linux VM へのマウント\nsudo mount -t cifs //mystorageaccount.file.core.windows.net/myshare /mnt/azure \\\n  -o vers=3.0,username=mystorageaccount,password=&#x3C;storage-key>,dir_mode=0777,file_mode=0777\n</code></pre>\n<h3>Managed Disks</h3>\n<pre><code class=\"language-bash\"># マネージドディスクの作成\naz disk create \\\n  --resource-group myResourceGroup \\\n  --name myDisk \\\n  --size-gb 128 \\\n  --sku Premium_LRS\n\n# スナップショットの作成\naz snapshot create \\\n  --resource-group myResourceGroup \\\n  --name mySnapshot \\\n  --source myDisk\n</code></pre>\n<h2>ネットワークサービス</h2>\n<h3>Virtual Network (VNet)</h3>\n<pre><code>Azure VNet アーキテクチャ\n┌────────────────────────────────────────────┐\n│ VNet: 10.0.0.0/16                          │\n│                                            │\n│  ┌─────────────────┐  ┌─────────────────┐  │\n│  │ Subnet-Web      │  │ Subnet-App      │  │\n│  │ 10.0.1.0/24     │  │ 10.0.2.0/24     │  │\n│  │ ┌───┐ ┌───┐     │  │ ┌───┐ ┌───┐     │  │\n│  │ │VM │ │VM │     │  │ │VM │ │VM │     │  │\n│  │ └───┘ └───┘     │  │ └───┘ └───┘     │  │\n│  │   NSG: Web      │  │   NSG: App      │  │\n│  └─────────────────┘  └─────────────────┘  │\n│                                            │\n│  ┌─────────────────────────────────────┐   │\n│  │ Subnet-DB: 10.0.3.0/24              │   │\n│  │ ┌─────┐   Private Endpoint          │   │\n│  │ │ SQL │ ←─────────────────          │   │\n│  │ └─────┘                             │   │\n│  └─────────────────────────────────────┘   │\n└────────────────────────────────────────────┘\n</code></pre>\n<pre><code class=\"language-bash\"># VNet の作成\naz network vnet create \\\n  --resource-group myResourceGroup \\\n  --name myVNet \\\n  --address-prefix 10.0.0.0/16 \\\n  --subnet-name mySubnet \\\n  --subnet-prefix 10.0.1.0/24\n\n# NSG の作成\naz network nsg create \\\n  --resource-group myResourceGroup \\\n  --name myNSG\n\n# ルールの追加\naz network nsg rule create \\\n  --resource-group myResourceGroup \\\n  --nsg-name myNSG \\\n  --name AllowHTTP \\\n  --priority 100 \\\n  --destination-port-ranges 80 443 \\\n  --access Allow \\\n  --protocol Tcp\n</code></pre>\n<h3>Application Gateway</h3>\n<pre><code class=\"language-bash\"># アプリケーションゲートウェイの作成\naz network application-gateway create \\\n  --resource-group myResourceGroup \\\n  --name myAppGateway \\\n  --sku Standard_v2 \\\n  --capacity 2 \\\n  --vnet-name myVNet \\\n  --subnet myAGSubnet \\\n  --public-ip-address myAGPublicIP \\\n  --servers 10.0.1.4 10.0.1.5\n</code></pre>\n<h3>Azure DNS</h3>\n<pre><code class=\"language-bash\"># DNS ゾーンの作成\naz network dns zone create \\\n  --resource-group myResourceGroup \\\n  --name example.com\n\n# レコードの追加\naz network dns record-set a add-record \\\n  --resource-group myResourceGroup \\\n  --zone-name example.com \\\n  --record-set-name www \\\n  --ipv4-address 1.2.3.4\n</code></pre>\n<h2>データベースサービス</h2>\n<h3>Azure SQL Database</h3>\n<pre><code class=\"language-bash\"># SQL サーバーの作成\naz sql server create \\\n  --resource-group myResourceGroup \\\n  --name myserver \\\n  --admin-user sqladmin \\\n  --admin-password MyPassword123!\n\n# データベースの作成\naz sql db create \\\n  --resource-group myResourceGroup \\\n  --server myserver \\\n  --name mydb \\\n  --service-objective S0\n\n# ファイアウォールの設定\naz sql server firewall-rule create \\\n  --resource-group myResourceGroup \\\n  --server myserver \\\n  --name AllowMyIP \\\n  --start-ip-address 1.2.3.4 \\\n  --end-ip-address 1.2.3.4\n</code></pre>\n<h3>Cosmos DB</h3>\n<pre><code class=\"language-python\">from azure.cosmos import CosmosClient\n\n# 接続\nclient = CosmosClient(endpoint, credential)\ndatabase = client.get_database_client(\"mydb\")\ncontainer = database.get_container_client(\"mycontainer\")\n\n# ドキュメントの作成\ncontainer.create_item(body={\n    \"id\": \"user123\",\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\"\n})\n\n# クエリ\nitems = container.query_items(\n    query=\"SELECT * FROM c WHERE c.name = @name\",\n    parameters=[{\"name\": \"@name\", \"value\": \"John Doe\"}]\n)\nfor item in items:\n    print(item)\n</code></pre>\n<h3>Azure Cache for Redis</h3>\n<pre><code class=\"language-bash\"># Redis キャッシュの作成\naz redis create \\\n  --resource-group myResourceGroup \\\n  --name myredis \\\n  --location eastasia \\\n  --sku Basic \\\n  --vm-size C0\n</code></pre>\n<h2>ID とアクセス管理</h2>\n<h3>Azure AD (Entra ID)</h3>\n<pre><code class=\"language-bash\"># サービスプリンシパルの作成\naz ad sp create-for-rbac \\\n  --name myServicePrincipal \\\n  --role Contributor \\\n  --scopes /subscriptions/{subscription-id}\n\n# ロールの割り当て\naz role assignment create \\\n  --assignee user@example.com \\\n  --role \"Virtual Machine Contributor\" \\\n  --scope /subscriptions/{subscription-id}/resourceGroups/myResourceGroup\n</code></pre>\n<h3>マネージド ID</h3>\n<pre><code class=\"language-bash\"># VM のシステム割り当てマネージド ID を有効化\naz vm identity assign \\\n  --resource-group myResourceGroup \\\n  --name myVM\n\n# Key Vault へのアクセス権を付与\naz keyvault set-policy \\\n  --name myKeyVault \\\n  --object-id &#x3C;principal-id> \\\n  --secret-permissions get list\n</code></pre>\n<h2>AKS (Kubernetes Service)</h2>\n<pre><code class=\"language-bash\"># AKS クラスタの作成\naz aks create \\\n  --resource-group myResourceGroup \\\n  --name myAKSCluster \\\n  --node-count 3 \\\n  --node-vm-size Standard_B2s \\\n  --enable-managed-identity \\\n  --generate-ssh-keys\n\n# 認証情報の取得\naz aks get-credentials \\\n  --resource-group myResourceGroup \\\n  --name myAKSCluster\n\n# アプリケーションのデプロイ\nkubectl apply -f deployment.yaml\n</code></pre>\n<h2>監視とログ</h2>\n<h3>Azure Monitor</h3>\n<pre><code class=\"language-bash\"># Log Analytics ワークスペースの作成\naz monitor log-analytics workspace create \\\n  --resource-group myResourceGroup \\\n  --workspace-name myWorkspace\n\n# アラートルールの作成\naz monitor metrics alert create \\\n  --resource-group myResourceGroup \\\n  --name highCPU \\\n  --scopes /subscriptions/.../virtualMachines/myVM \\\n  --condition \"avg Percentage CPU > 80\" \\\n  --window-size 5m \\\n  --evaluation-frequency 1m\n</code></pre>\n<h2>コスト管理</h2>\n<pre><code class=\"language-bash\"># コストの確認\naz consumption usage list \\\n  --start-date 2024-01-01 \\\n  --end-date 2024-01-31\n\n# 予算の作成\naz consumption budget create \\\n  --budget-name MonthlyBudget \\\n  --amount 1000 \\\n  --category Cost \\\n  --time-grain Monthly\n</code></pre>\n<h2>まとめ</h2>\n<p>Azure コアサービスのポイント：</p>\n<ol>\n<li><strong>コンピューティング</strong>: VM, Functions, Container Instances, AKS</li>\n<li><strong>ストレージ</strong>: Blob Storage, Files, Managed Disks</li>\n<li><strong>データベース</strong>: SQL Database, Cosmos DB, Cache for Redis</li>\n<li><strong>ネットワーク</strong>: VNet, Application Gateway, Azure DNS, Front Door</li>\n<li><strong>ID</strong>: Azure AD/Entra ID, Managed Identity</li>\n<li><strong>監視</strong>: Azure Monitor, Log Analytics, Application Insights</li>\n</ol>\n"
}