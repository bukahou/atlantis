{
  "meta": {
    "title": "L2 データリンク層",
    "description": "データリンク層：イーサネット、MAC アドレス、スイッチ、VLAN と STP",
    "order": 3,
    "tags": ["データリンク層", "L2", "イーサネット", "スイッチ", "VLAN"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コアコンセプト",
      "items": [
        "データリンク層は隣接ノード間のフレーム転送を担当",
        "MAC アドレスで物理アドレス指定",
        "エラー検出を提供（FCS）",
        "LLC と MAC の2つのサブレイヤーを含む"
      ]
    },
    {
      "type": "text",
      "title": "データリンク層概要",
      "content": "データリンク層は OSI モデルの第2層で、直接接続された2つのノード間でデータフレームを確実に転送する役割を担います。物理層のビットストリームをフレームに組織化し、MAC アドレスでネットワーク機器を識別します。主な機能にはフレーム区切り、物理アドレス指定、エラー検出、メディアアクセス制御があります。"
    },
    {
      "type": "cards",
      "title": "L2 コア知識ポイント",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "イーサネット (Ethernet)",
          "badge": "プロトコル",
          "badgeColor": "blue",
          "points": [
            "IEEE 802.3 規格",
            "CSMA/CD アクセス制御",
            "最も広く使用される LAN 技術"
          ]
        },
        {
          "title": "L2 スイッチ",
          "badge": "機器",
          "badgeColor": "green",
          "points": [
            "MAC アドレスベースの転送",
            "MAC アドレステーブル学習",
            "コリジョンドメインの分離"
          ]
        },
        {
          "title": "VLAN",
          "badge": "技術",
          "badgeColor": "purple",
          "points": [
            "仮想 LAN 分離",
            "802.1Q タグ",
            "ブロードキャストドメイン分割"
          ]
        },
        {
          "title": "STP/RSTP",
          "badge": "プロトコル",
          "badgeColor": "amber",
          "points": [
            "ループ防止",
            "冗長リンク管理",
            "自動収束"
          ]
        },
        {
          "title": "ARP",
          "badge": "プロトコル",
          "badgeColor": "cyan",
          "points": [
            "IP → MAC マッピング",
            "ARP キャッシュ",
            "L2/L3 境界をまたぐ"
          ]
        },
        {
          "title": "リンクアグリゲーション",
          "badge": "技術",
          "badgeColor": "red",
          "points": [
            "LACP (802.3ad)",
            "帯域幅増加",
            "リンク冗長性"
          ]
        }
      ]
    },
    {
      "type": "table",
      "title": "イーサネットフレーム構造",
      "highlightFirst": true,
      "headers": ["フィールド", "サイズ", "説明"],
      "rows": [
        ["プリアンブル", "7 バイト", "クロック同期"],
        ["SFD (フレーム開始)", "1 バイト", "フレーム開始マーカー (10101011)"],
        ["宛先 MAC", "6 バイト", "受信側物理アドレス"],
        ["送信元 MAC", "6 バイト", "送信側物理アドレス"],
        ["タイプ/長さ", "2 バイト", "0x0800=IPv4, 0x0806=ARP"],
        ["データ", "46-1500 バイト", "上位プロトコルデータ (MTU)"],
        ["FCS", "4 バイト", "フレームチェックシーケンス (CRC-32)"]
      ]
    },
    {
      "type": "codeBlock",
      "title": "MAC アドレス形式",
      "language": "text",
      "code": "MAC アドレス: 48 ビット (6 バイト)\n形式: XX:XX:XX:XX:XX:XX または XX-XX-XX-XX-XX-XX\n\n例: 00:1A:2B:3C:4D:5E\n    |_____|  |_____|\n      OUI    デバイス識別子\n\nOUI (前半 24 ビット): 組織固有識別子、IEEE がベンダーに割り当て\nデバイス識別子 (後半 24 ビット): ベンダーが独自に割り当て\n\n特殊アドレス:\n- FF:FF:FF:FF:FF:FF  ブロードキャストアドレス\n- 01:XX:XX:XX:XX:XX  マルチキャストアドレス (第1バイト最下位ビットが1)\n- ローカル管理アドレス: 第1バイト第2最下位ビットが1"
    },
    {
      "type": "flow",
      "title": "スイッチ動作原理",
      "subtitle": "MAC アドレステーブルベースのフレーム転送",
      "direction": "horizontal",
      "steps": [
        { "label": "フレーム受信", "description": "ポートからフレームを受信", "color": "bg-blue-500" },
        { "label": "送信元 MAC 学習", "description": "MAC-ポートマッピングを記録", "color": "bg-purple-500" },
        { "label": "テーブル検索", "description": "宛先 MAC を検索", "color": "bg-cyan-500" },
        { "label": "ユニキャスト/フラッディング", "description": "既知はユニキャスト、未知はフラッディング", "color": "bg-green-500" }
      ]
    },
    {
      "type": "codeBlock",
      "title": "スイッチ MAC アドレステーブル",
      "language": "text",
      "code": "# Cisco スイッチで MAC アドレステーブルを表示\nshow mac address-table\n\nMAC Address Table\n-------------------------------------------\nVlan    Mac Address       Type        Ports\n----    -----------       --------    -----\n1       00:1a:2b:3c:4d:5e DYNAMIC     Gi0/1\n1       00:1a:2b:3c:4d:5f DYNAMIC     Gi0/2\n10      00:1a:2b:3c:4d:60 DYNAMIC     Gi0/3\n\n# Linux でローカル MAC を確認\nip link show\ncat /sys/class/net/eth0/address\n\n# ARP キャッシュを確認\narp -n\nip neigh show"
    },
    {
      "type": "comparison",
      "title": "ハブ vs スイッチ",
      "columns": [
        {
          "title": "ハブ (Hub)",
          "color": "from-gray-500 to-gray-600",
          "items": [
            { "label": "レイヤー", "description": "L1 物理層" },
            { "label": "転送方式", "description": "全ポートにブロードキャスト" },
            { "label": "コリジョンドメイン", "description": "全ポート共有" },
            { "label": "帯域幅", "description": "全ポート共有" },
            { "label": "状態", "description": "廃止" }
          ]
        },
        {
          "title": "スイッチ (Switch)",
          "color": "from-green-500 to-emerald-500",
          "items": [
            { "label": "レイヤー", "description": "L2 データリンク層" },
            { "label": "転送方式", "description": "MAC テーブルベースの転送" },
            { "label": "コリジョンドメイン", "description": "各ポート独立" },
            { "label": "帯域幅", "description": "各ポート専有" },
            { "label": "状態", "description": "主流機器" }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "VLAN 設定例 (Cisco)",
      "language": "text",
      "code": "# VLAN 作成\nvlan 10\n  name Engineering\nvlan 20\n  name Sales\n\n# ポートを VLAN に割り当て (Access モード)\ninterface GigabitEthernet0/1\n  switchport mode access\n  switchport access vlan 10\n\n# Trunk ポート (複数 VLAN を転送)\ninterface GigabitEthernet0/24\n  switchport mode trunk\n  switchport trunk allowed vlan 10,20\n  switchport trunk native vlan 1\n\n# VLAN 確認\nshow vlan brief"
    },
    {
      "type": "table",
      "title": "VLAN ポートタイプ",
      "highlightFirst": true,
      "headers": ["タイプ", "用途", "タグ処理"],
      "rows": [
        ["Access", "端末機器接続", "受信：タグ付与、送信：タグ除去"],
        ["Trunk", "スイッチ間接続", "802.1Q タグ保持"],
        ["Hybrid", "混合モード", "柔軟なタグポリシー設定"],
        ["Native VLAN", "Trunk デフォルト VLAN", "タグなしフレームが属する VLAN"]
      ]
    },
    {
      "type": "codeBlock",
      "title": "802.1Q VLAN タグ",
      "language": "text",
      "code": "標準イーサネットフレーム:\n| Dest MAC | Src MAC | Type | Data | FCS |\n\n802.1Q タグ付きフレーム:\n| Dest MAC | Src MAC | 802.1Q Tag | Type | Data | FCS |\n                      |________|\n                        4 バイト\n\n802.1Q Tag 構造 (4 バイト):\n| TPID (2B) | TCI (2B) |\n| 0x8100    | PCP | DEI | VID |\n              3b    1b   12b\n\nTCI (Tag Control Information):\n- PCP (3 bit): 優先度 (0-7)、QoS で使用\n- DEI (1 bit): 破棄指示\n- VID (12 bit): VLAN ID (0-4095)"
    },
    {
      "type": "cards",
      "title": "STP スパニングツリープロトコル",
      "layout": "grid",
      "columns": 2,
      "items": [
        {
          "title": "STP 原理",
          "badge": "802.1D",
          "badgeColor": "blue",
          "points": [
            "ルートブリッジを選出",
            "最短経路を計算",
            "冗長ポートをブロックしてループ防止"
          ]
        },
        {
          "title": "ポート状態",
          "badge": "状態遷移",
          "badgeColor": "green",
          "points": [
            "Blocking → Listening",
            "Listening → Learning",
            "Learning → Forwarding"
          ]
        },
        {
          "title": "RSTP 高速収束",
          "badge": "802.1w",
          "badgeColor": "amber",
          "points": [
            "収束時間 < 1秒",
            "ポート状態を簡素化",
            "アクティブネゴシエーション機構"
          ]
        },
        {
          "title": "MSTP マルチインスタンス",
          "badge": "802.1s",
          "badgeColor": "purple",
          "points": [
            "複数 VLAN のロードバランス",
            "インスタンスごとに独立トポロジー",
            "大規模ネットワーク推奨"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "Linux VLAN 設定",
      "language": "bash",
      "code": "# vlan ツールをインストール\napt install vlan\n\n# 8021q モジュールをロード\nmodprobe 8021q\n\n# VLAN インターフェースを作成\nip link add link eth0 name eth0.10 type vlan id 10\nip link set eth0.10 up\nip addr add 192.168.10.1/24 dev eth0.10\n\n# VLAN インターフェースを確認\ncat /proc/net/vlan/config\nip -d link show eth0.10\n\n# VLAN インターフェースを削除\nip link delete eth0.10"
    },
    {
      "type": "list",
      "title": "L2 ベストプラクティス",
      "style": "check",
      "items": [
        { "label": "STP/RSTP を有効化", "description": "ネットワークループによるブロードキャストストームを防止" },
        { "label": "適切な VLAN 設計", "description": "部門/機能別にブロードキャストドメインを分離" },
        { "label": "Trunk セキュリティ", "description": "許可 VLAN を制限、未使用ポートを無効化" },
        { "label": "MAC アドレスセキュリティ", "description": "ポートセキュリティで MAC 数を制限" },
        { "label": "リンクアグリゲーション", "description": "LACP で帯域幅と冗長性を確保" }
      ]
    }
  ],
  "relatedTopics": ["OSI モデル", "L3 ネットワーク層", "ネットワークセキュリティ"]
}
