{
  "meta": {
    "title": "L3 ネットワーク層",
    "description": "ネットワーク層：IP プロトコル、ルーティング、サブネット分割と NAT",
    "order": 4,
    "tags": ["ネットワーク層", "L3", "IP", "ルーティング", "サブネット"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コアコンセプト",
      "items": [
        "ネットワーク層はネットワーク間のパケット転送を担当",
        "IP アドレスで論理アドレス指定",
        "ルーターはルーティングテーブルに基づきパケットを転送",
        "ネットワーク間の相互接続を実現"
      ]
    },
    {
      "type": "text",
      "title": "ネットワーク層概要",
      "content": "ネットワーク層は OSI モデルの第3層で、異なるネットワーク間でパケットを転送する役割を担います。論理アドレス（IP アドレス）を使用して送信元と宛先ホストを識別し、ルーティングプロトコルでパケットの最適な転送経路を決定します。ネットワーク層の中核機器はルーターです。"
    },
    {
      "type": "cards",
      "title": "L3 コア知識ポイント",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "IP プロトコル",
          "badge": "プロトコル",
          "badgeColor": "blue",
          "points": [
            "IPv4 / IPv6",
            "コネクションレス、ベストエフォート",
            "パケットのフラグメント化と再構築"
          ]
        },
        {
          "title": "ルーティング",
          "badge": "コア",
          "badgeColor": "green",
          "points": [
            "スタティック / ダイナミックルーティング",
            "ルーティングテーブルと転送",
            "RIP, OSPF, BGP"
          ]
        },
        {
          "title": "サブネット分割",
          "badge": "技術",
          "badgeColor": "purple",
          "points": [
            "CIDR 表記法",
            "サブネットマスク",
            "アドレス計画"
          ]
        },
        {
          "title": "NAT",
          "badge": "技術",
          "badgeColor": "amber",
          "points": [
            "アドレス変換",
            "SNAT / DNAT",
            "ポートマッピング"
          ]
        },
        {
          "title": "ICMP",
          "badge": "プロトコル",
          "badgeColor": "cyan",
          "points": [
            "エラー報告",
            "ping / traceroute",
            "ネットワーク診断"
          ]
        },
        {
          "title": "L3 スイッチ",
          "badge": "機器",
          "badgeColor": "red",
          "points": [
            "ハードウェアルーティング",
            "VLAN 間ルーティング",
            "高性能転送"
          ]
        }
      ]
    },
    {
      "type": "table",
      "title": "IPv4 アドレスクラス",
      "highlightFirst": true,
      "headers": ["クラス", "範囲", "デフォルトマスク", "用途"],
      "rows": [
        ["クラス A", "1.0.0.0 - 126.255.255.255", "/8", "大規模ネットワーク"],
        ["クラス B", "128.0.0.0 - 191.255.255.255", "/16", "中規模ネットワーク"],
        ["クラス C", "192.0.0.0 - 223.255.255.255", "/24", "小規模ネットワーク"],
        ["クラス D", "224.0.0.0 - 239.255.255.255", "-", "マルチキャストアドレス"],
        ["クラス E", "240.0.0.0 - 255.255.255.255", "-", "予約アドレス"]
      ]
    },
    {
      "type": "table",
      "title": "プライベート IP アドレス範囲",
      "highlightFirst": true,
      "headers": ["クラス", "アドレス範囲", "CIDR", "利用可能ホスト数"],
      "rows": [
        ["クラス A プライベート", "10.0.0.0 - 10.255.255.255", "10.0.0.0/8", "16,777,214"],
        ["クラス B プライベート", "172.16.0.0 - 172.31.255.255", "172.16.0.0/12", "1,048,574"],
        ["クラス C プライベート", "192.168.0.0 - 192.168.255.255", "192.168.0.0/16", "65,534"]
      ]
    },
    {
      "type": "codeBlock",
      "title": "IP アドレスとサブネット計算",
      "language": "text",
      "code": "IP アドレス: 192.168.1.100\nサブネットマスク: 255.255.255.0 (/24)\n\n2進数表記:\nIP:   11000000.10101000.00000001.01100100\nMask: 11111111.11111111.11111111.00000000\n\nネットワークアドレス: 192.168.1.0   (IP AND Mask)\nブロードキャストアドレス: 192.168.1.255 (ネットワークアドレス OR ~Mask)\n利用可能ホスト: 192.168.1.1 - 192.168.1.254\nホスト数: 2^8 - 2 = 254\n\nCIDR 表記法:\n/24 = 256 アドレス (254 利用可能)\n/25 = 128 アドレス (126 利用可能)\n/26 = 64 アドレス (62 利用可能)\n/27 = 32 アドレス (30 利用可能)\n/28 = 16 アドレス (14 利用可能)\n/29 = 8 アドレス (6 利用可能)\n/30 = 4 アドレス (2 利用可能、ポイントツーポイントリンク)"
    },
    {
      "type": "comparison",
      "title": "IPv4 vs IPv6",
      "columns": [
        {
          "title": "IPv4",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            { "label": "アドレス長", "description": "32 ビット (4 バイト)" },
            { "label": "アドレス数", "description": "約 43 億" },
            { "label": "表記法", "description": "ドット区切り10進数" },
            { "label": "例", "description": "192.168.1.1" },
            { "label": "ヘッダ", "description": "20-60 バイト" }
          ]
        },
        {
          "title": "IPv6",
          "color": "from-green-500 to-emerald-500",
          "items": [
            { "label": "アドレス長", "description": "128 ビット (16 バイト)" },
            { "label": "アドレス数", "description": "3.4×10³⁸" },
            { "label": "表記法", "description": "コロン区切り16進数" },
            { "label": "例", "description": "2001:db8::1" },
            { "label": "ヘッダ", "description": "固定 40 バイト" }
          ]
        }
      ]
    },
    {
      "type": "flow",
      "title": "ルーティング転送プロセス",
      "subtitle": "ルーターがパケットを転送する方法",
      "direction": "horizontal",
      "steps": [
        { "label": "パケット受信", "description": "入力インターフェースから受信", "color": "bg-blue-500" },
        { "label": "宛先 IP 解析", "description": "IP ヘッダを読み取り", "color": "bg-purple-500" },
        { "label": "ルーティングテーブル検索", "description": "最長プレフィックスマッチ", "color": "bg-cyan-500" },
        { "label": "転送", "description": "出力インターフェースへ送信", "color": "bg-green-500" }
      ]
    },
    {
      "type": "codeBlock",
      "title": "ルーティングテーブル例",
      "language": "bash",
      "code": "# Linux でルーティングテーブルを表示\nip route show\nroute -n\n\n# 出力例\ndefault via 192.168.1.1 dev eth0 proto dhcp metric 100\n192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.100\n10.0.0.0/8 via 192.168.1.254 dev eth0\n\n# スタティックルートを追加\nip route add 10.10.0.0/16 via 192.168.1.254\nip route add default via 192.168.1.1\n\n# ルートを削除\nip route del 10.10.0.0/16\n\n# 宛先へのルートを確認\nip route get 8.8.8.8"
    },
    {
      "type": "cards",
      "title": "ダイナミックルーティングプロトコル",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "RIP",
          "badge": "距離ベクトル",
          "badgeColor": "gray",
          "points": [
            "最大ホップ数 15",
            "収束が遅い",
            "小規模ネットワーク向け"
          ]
        },
        {
          "title": "OSPF",
          "badge": "リンクステート",
          "badgeColor": "blue",
          "points": [
            "SPF アルゴリズム",
            "高速収束",
            "企業ネットワーク推奨"
          ]
        },
        {
          "title": "BGP",
          "badge": "パスベクトル",
          "badgeColor": "green",
          "points": [
            "AS 間ルーティング",
            "インターネット基幹",
            "ポリシールーティング"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "NAT 設定 (iptables)",
      "language": "bash",
      "code": "# IP フォワーディングを有効化\necho 1 > /proc/sys/net/ipv4/ip_forward\n\n# SNAT: 内部から外部へのアクセス（送信元アドレス変換）\niptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j MASQUERADE\n# または IP を指定\niptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j SNAT --to-source 1.2.3.4\n\n# DNAT: ポートマッピング（宛先アドレス変換）\niptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.10:80\n\n# NAT ルールを確認\niptables -t nat -L -n -v\n\n# コネクショントラッキングを確認\nconntrack -L"
    },
    {
      "type": "table",
      "title": "ICMP メッセージタイプ",
      "highlightFirst": true,
      "headers": ["タイプ", "名称", "用途"],
      "rows": [
        ["0", "Echo Reply", "ping 応答"],
        ["3", "Destination Unreachable", "宛先到達不能"],
        ["5", "Redirect", "ルートリダイレクト"],
        ["8", "Echo Request", "ping 要求"],
        ["11", "Time Exceeded", "TTL 超過 (traceroute)"]
      ]
    },
    {
      "type": "codeBlock",
      "title": "ネットワーク診断コマンド",
      "language": "bash",
      "code": "# ping で疎通確認\nping -c 4 8.8.8.8\n\n# traceroute でルート経路を追跡\ntraceroute 8.8.8.8\nmtr 8.8.8.8  # より優れたツール\n\n# ARP キャッシュを確認\narp -n\nip neigh show\n\n# パケットキャプチャ\ntcpdump -i eth0 icmp\ntcpdump -i eth0 'host 192.168.1.1 and port 80'"
    },
    {
      "type": "list",
      "title": "L3 ベストプラクティス",
      "style": "check",
      "items": [
        { "label": "適切なサブネット計画", "description": "拡張余地を確保し、頻繁な変更を避ける" },
        { "label": "CIDR を使用", "description": "柔軟なアドレス割り当て、ルーティングエントリを削減" },
        { "label": "ルート集約", "description": "ルーティングエントリを減らし、転送効率を向上" },
        { "label": "デフォルトルート", "description": "ルーティング設定を簡素化、上位ゲートウェイを指定" },
        { "label": "ECMP ロードバランス", "description": "マルチパス等価ルーティングで帯域利用率を向上" }
      ]
    }
  ],
  "relatedTopics": ["OSI モデル", "L2 データリンク層", "TCP/IP"]
}
