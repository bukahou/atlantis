{
  "meta": {
    "title": "冗長設計",
    "description": "単一障害点を排除するための戦略と実践",
    "order": 1,
    "tags": ["高可用性", "冗長性", "SPOF"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コアコンセプト",
      "items": [
        "SPOF (Single Point of Failure)：単一障害点",
        "冗長性：バックアップによる単一障害点の排除",
        "N+1/N+M：フォールトトレランス設計パターン",
        "ステートレスサービス：水平スケーリングの基盤"
      ]
    },
    {
      "type": "cards",
      "title": "冗長タイプ",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "コンピュート冗長",
          "badge": "サービス層",
          "badgeColor": "blue",
          "points": [
            "マルチインスタンスデプロイ",
            "ロードバランシング",
            "ステートレス設計"
          ]
        },
        {
          "title": "ストレージ冗長",
          "badge": "データ層",
          "badgeColor": "green",
          "points": [
            "マスター・スレーブ複製",
            "マルチレプリカストレージ",
            "RAIDアレイ"
          ]
        },
        {
          "title": "ネットワーク冗長",
          "badge": "インフラ",
          "badgeColor": "purple",
          "points": [
            "マルチリンク接続",
            "クロスAZ",
            "DNSフェイルオーバー"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "ステートレスサービス設計",
      "language": "go",
      "code": "// ステートフルサービス（非推奨）\ntype StatefulService struct {\n    sessions map[string]*Session  // ローカルにセッション保存\n}\n\n// ステートレスサービス（推奨）\ntype StatelessService struct {\n    sessionStore SessionStore  // 外部ストレージ（Redis）\n    config       *Config       // 読み取り専用設定\n}\n\nfunc (s *StatelessService) HandleRequest(r *Request) (*Response, error) {\n    // リクエストから状態識別子を取得\n    sessionID := r.Header.Get(\"X-Session-ID\")\n    \n    // 外部ストレージから状態を取得\n    session, err := s.sessionStore.Get(sessionID)\n    if err != nil {\n        return nil, err\n    }\n    \n    // リクエストを処理...\n    \n    // 状態を外部ストレージに更新\n    return response, s.sessionStore.Set(session)\n}\n\n// メリット：\n// 1. 任意のインスタンスが任意のリクエストを処理可能\n// 2. 水平スケーリングが容易\n// 3. インスタンス障害時も状態が失われない"
    },
    {
      "type": "codeBlock",
      "title": "データベースマスター・スレーブ複製",
      "language": "yaml",
      "code": "# MySQL マスター・スレーブ設定\nmaster:\n  server-id: 1\n  log-bin: mysql-bin\n  binlog-format: ROW\n  sync-binlog: 1  # トランザクション毎にbinlogを同期\n\nslave:\n  server-id: 2\n  relay-log: mysql-relay\n  read-only: true\n  replica-parallel-workers: 4  # 並列レプリケーション\n\n# セミ同期レプリケーション（整合性向上）\nmaster:\n  rpl_semi_sync_master_enabled: ON\n  rpl_semi_sync_master_timeout: 1000  # 1秒タイムアウト\n\n# 読み書き分離\nread:\n  - slave1:3306\n  - slave2:3306\nwrite:\n  - master:3306"
    },
    {
      "type": "table",
      "title": "冗長モード比較",
      "highlightFirst": true,
      "headers": ["モード", "説明", "コスト", "復旧時間"],
      "rows": [
        ["Active-Passive", "主待機モード、待機系はスタンバイ", "2x", "秒〜分"],
        ["Active-Active", "両系稼働、同時にサービス提供", "2x+", "ミリ秒級"],
        ["N+1", "N台のサービス+1台の予備", "N+1", "秒級"],
        ["N+M", "より多い冗長、より高い可用性", "N+M", "秒級"]
      ]
    },
    {
      "type": "list",
      "title": "チェックリスト",
      "style": "check",
      "items": [
        { "label": "全SPOFを特定", "description": "データベース、キャッシュ、MQ、外部サービス" },
        { "label": "サービスのステートレス化", "description": "状態をRedis/データベースに外出し" },
        { "label": "マルチAZデプロイ", "description": "複数データセンター/AZに分散" },
        { "label": "定期的な障害訓練", "description": "Chaos Engineeringで冗長性を検証" }
      ]
    }
  ],
  "relatedTopics": ["ロードバランシング", "フェイルオーバー", "Chaos Engineering"]
}
