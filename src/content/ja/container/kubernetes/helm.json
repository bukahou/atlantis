{
  "meta": {
    "title": "Helm パッケージ管理",
    "description": "Helm Chart 開発とアプリケーションデプロイ",
    "order": 4,
    "tags": ["Kubernetes", "Helm", "パッケージ管理"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コアコンセプト",
      "items": [
        "Helm は Kubernetes のパッケージマネージャー",
        "Chart は Helm のパッケージ形式",
        "テンプレート化とパラメータ設定をサポート",
        "Release は Chart の実行インスタンス"
      ]
    },
    {
      "type": "text",
      "title": "Helm とは",
      "content": "Helm は Kubernetes のパッケージマネージャーと呼ばれ、apt や yum に似ています。複雑な Kubernetes アプリケーションを Chart としてパッケージ化し、バージョン管理、パラメータ化設定、ワンクリックデプロイをサポートすることで、アプリケーションの配布とデプロイを大幅に簡素化します。"
    },
    {
      "type": "flow",
      "title": "Helm ワークフロー",
      "subtitle": "Chart から Release まで",
      "direction": "horizontal",
      "steps": [
        { "label": "Chart", "description": "アプリケーションテンプレート", "color": "bg-gray-500" },
        { "label": "values.yaml", "description": "設定パラメータ", "color": "bg-blue-500" },
        { "label": "helm install", "description": "テンプレートをレンダリング", "color": "bg-purple-500" },
        { "label": "Release", "description": "デプロイインスタンス", "color": "bg-green-500" }
      ]
    },
    {
      "type": "codeBlock",
      "title": "Chart ディレクトリ構造",
      "language": "text",
      "code": "mychart/\n├── Chart.yaml          # Chart メタデータ\n├── values.yaml         # デフォルト設定値\n├── charts/             # 依存 Chart\n├── templates/          # テンプレートファイル\n│   ├── deployment.yaml\n│   ├── service.yaml\n│   ├── ingress.yaml\n│   ├── _helpers.tpl    # テンプレートヘルパー関数\n│   └── NOTES.txt       # インストール説明\n└── .helmignore         # 無視ファイル"
    },
    {
      "type": "codeBlock",
      "title": "テンプレート例",
      "language": "yaml",
      "code": "# templates/deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: {{ include \"mychart.fullname\" . }}\n  labels:\n    {{- include \"mychart.labels\" . | nindent 4 }}\nspec:\n  replicas: {{ .Values.replicaCount }}\n  selector:\n    matchLabels:\n      {{- include \"mychart.selectorLabels\" . | nindent 6 }}\n  template:\n    metadata:\n      labels:\n        {{- include \"mychart.selectorLabels\" . | nindent 8 }}\n    spec:\n      containers:\n      - name: {{ .Chart.Name }}\n        image: \"{{ .Values.image.repository }}:{{ .Values.image.tag }}\"\n        ports:\n        - containerPort: {{ .Values.service.port }}"
    },
    {
      "type": "codeBlock",
      "title": "values.yaml 例",
      "language": "yaml",
      "code": "# デフォルト設定\nreplicaCount: 1\n\nimage:\n  repository: nginx\n  tag: \"1.24\"\n  pullPolicy: IfNotPresent\n\nservice:\n  type: ClusterIP\n  port: 80\n\ningress:\n  enabled: false\n  className: nginx\n  hosts:\n    - host: example.local\n      paths:\n        - path: /\n          pathType: Prefix\n\nresources:\n  limits:\n    cpu: 100m\n    memory: 128Mi\n  requests:\n    cpu: 100m\n    memory: 128Mi"
    },
    {
      "type": "table",
      "title": "Helm よく使うコマンド",
      "highlightFirst": true,
      "headers": ["コマンド", "説明"],
      "rows": [
        ["helm repo add bitnami https://charts.bitnami.com/bitnami", "リポジトリを追加"],
        ["helm search repo nginx", "Chart を検索"],
        ["helm install my-nginx bitnami/nginx", "Chart をインストール"],
        ["helm upgrade my-nginx bitnami/nginx", "Release をアップグレード"],
        ["helm list", "Release を一覧表示"],
        ["helm uninstall my-nginx", "Release をアンインストール"],
        ["helm template ./mychart", "テンプレートをレンダリング（インストールしない）"],
        ["helm package ./mychart", "Chart をパッケージ化"]
      ]
    },
    {
      "type": "cards",
      "title": "テンプレート関数",
      "layout": "grid",
      "columns": 2,
      "items": [
        {
          "title": "組み込みオブジェクト",
          "badge": "Objects",
          "badgeColor": "blue",
          "points": [
            ".Values - 設定値",
            ".Chart - Chart メタデータ",
            ".Release - Release 情報",
            ".Files - ファイルアクセス"
          ]
        },
        {
          "title": "よく使う関数",
          "badge": "Functions",
          "badgeColor": "green",
          "points": [
            "include - テンプレート参照",
            "default - デフォルト値",
            "quote - 引用符を追加",
            "toYaml - YAML に変換"
          ]
        },
        {
          "title": "フロー制御",
          "badge": "Control",
          "badgeColor": "amber",
          "points": [
            "if/else - 条件分岐",
            "range - ループ処理",
            "with - スコープ",
            "define - テンプレート定義"
          ]
        },
        {
          "title": "パイプライン操作",
          "badge": "Pipeline",
          "badgeColor": "purple",
          "points": [
            "| nindent N - インデント",
            "| trim - 空白を削除",
            "| b64enc - Base64",
            "| required - 必須"
          ]
        }
      ]
    },
    {
      "type": "list",
      "title": "ベストプラクティス",
      "style": "check",
      "items": [
        { "label": "_helpers.tpl を使用", "description": "再利用可能なテンプレートフラグメントを定義" },
        { "label": "適切なデフォルト値を提供", "description": "values.yaml に本番対応のデフォルト値を設定" },
        { "label": "Chart 依存関係を使用", "description": "Chart.yaml で依存関係を管理" },
        { "label": "セマンティックバージョニング", "description": "SemVer バージョン規則に従う" },
        { "label": "NOTES.txt を記述", "description": "インストール後の使用方法を提供" }
      ]
    }
  ],
  "relatedTopics": ["Kubernetes", "GitOps", "ArgoCD"]
}
