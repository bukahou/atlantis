{
  "meta": {
    "title": "データベース正規化",
    "description": "データベース正規化理論、非正規化設計とデータモデリング",
    "order": 1,
    "tags": ["データベース設計", "正規化", "モデリング"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "コアコンセプト",
      "items": [
        "正規化はリレーショナルデータベースの冗長性を排除するための設計指針",
        "低から高へ：1NF -> 2NF -> 3NF -> BCNF",
        "高い正規化は冗長性を減らすが、クエリ性能に影響する可能性",
        "実際の設計では正規化と性能のバランスが必要"
      ]
    },
    {
      "type": "flow",
      "title": "正規化レベル",
      "direction": "horizontal",
      "steps": [
        { "label": "1NF", "description": "原子性", "color": "bg-blue-500" },
        { "label": "2NF", "description": "部分従属の排除", "color": "bg-cyan-500" },
        { "label": "3NF", "description": "推移的従属の排除", "color": "bg-green-500" },
        { "label": "BCNF", "description": "主属性従属の排除", "color": "bg-purple-500" }
      ]
    },
    {
      "type": "cards",
      "title": "正規化詳解",
      "layout": "grid",
      "columns": 2,
      "items": [
        {
          "title": "第一正規形 (1NF)",
          "badge": "原子性",
          "badgeColor": "blue",
          "points": [
            "各属性は分割不可",
            "配列/リストを保存できない",
            "例：products に \"A,B,C\" は保存不可"
          ]
        },
        {
          "title": "第二正規形 (2NF)",
          "badge": "完全従属",
          "badgeColor": "green",
          "points": [
            "1NF を満たす",
            "非キー属性が主キーに完全従属",
            "部分従属を排除"
          ]
        },
        {
          "title": "第三正規形 (3NF)",
          "badge": "直接従属",
          "badgeColor": "amber",
          "points": [
            "2NF を満たす",
            "非キー属性が主キーに推移的に従属しない",
            "推移的従属を排除"
          ]
        },
        {
          "title": "BCNF",
          "badge": "決定因子",
          "badgeColor": "purple",
          "points": [
            "3NF を満たす",
            "すべての決定因子が候補キー",
            "より厳格な 3NF"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "3NF 例",
      "language": "sql",
      "code": "-- 3NF 違反 (推移的従属)\n-- department_name は department_id に従属\nCREATE TABLE employees_bad (\n    id INT PRIMARY KEY,\n    name VARCHAR(100),\n    department_id INT,\n    department_name VARCHAR(100)  -- 推移的従属\n);\n\n-- 3NF 準拠\nCREATE TABLE departments (\n    id INT PRIMARY KEY,\n    name VARCHAR(100)\n);\n\nCREATE TABLE employees (\n    id INT PRIMARY KEY,\n    name VARCHAR(100),\n    department_id INT REFERENCES departments(id)\n);"
    },
    {
      "type": "comparison",
      "title": "正規化 vs 非正規化",
      "columns": [
        {
          "title": "正規化",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            { "label": "メリット", "description": "冗長性削減、データ一貫性" },
            { "label": "デメリット", "description": "複数テーブル JOIN、クエリ複雑" },
            { "label": "適用", "description": "OLTP、書き込み多め" }
          ]
        },
        {
          "title": "非正規化",
          "color": "from-green-500 to-emerald-500",
          "items": [
            { "label": "メリット", "description": "クエリ高速、JOIN 削減" },
            { "label": "デメリット", "description": "データ冗長、更新複雑" },
            { "label": "適用", "description": "OLAP、読み取り多め" }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "非正規化テクニック",
      "language": "sql",
      "code": "-- 1. 冗長フィールド (JOIN 回避)\nCREATE TABLE orders (\n    id INT PRIMARY KEY,\n    user_id INT,\n    user_name VARCHAR(100),  -- 冗長\n    total_amount DECIMAL(10,2)\n);\n\n-- 2. 事前計算フィールド\nCREATE TABLE products (\n    id INT PRIMARY KEY,\n    name VARCHAR(100),\n    review_count INT DEFAULT 0,\n    avg_rating DECIMAL(2,1) DEFAULT 0\n);\n\n-- 3. サマリーテーブル\nCREATE TABLE daily_sales (\n    date DATE PRIMARY KEY,\n    total_orders INT,\n    total_revenue DECIMAL(12,2)\n);"
    },
    {
      "type": "table",
      "title": "エンティティ関係",
      "highlightFirst": true,
      "headers": ["関係タイプ", "実装方法", "例"],
      "rows": [
        ["一対一", "主キー関連/同一テーブル", "ユーザー-詳細"],
        ["一対多", "外部キー関連", "カテゴリ-商品"],
        ["多対多", "中間テーブル", "商品-タグ"],
        ["自己参照", "自己参照外部キー", "従業員-上司"]
      ]
    },
    {
      "type": "list",
      "title": "設計原則",
      "style": "check",
      "items": [
        { "label": "高正規化から開始", "description": "性能要件に応じて適宜非正規化" },
        { "label": "命名規約", "description": "テーブル名は複数形、外部キーは table_id" },
        { "label": "主キー設計", "description": "自動採番 ID または分散 ID" },
        { "label": "決定を記録", "description": "非正規化の理由をドキュメント化" }
      ]
    }
  ],
  "relatedTopics": ["インデックス設計", "シャーディング", "データモデリング"]
}
