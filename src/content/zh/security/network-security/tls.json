{
  "meta": {
    "title": "TLS/SSL",
    "description": "TLS 1.3、证书管理与配置",
    "order": 1,
    "tags": ["TLS", "HTTPS", "证书"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "TLS：传输层安全协议，HTTPS 的基础",
        "握手过程：密钥交换 + 服务器认证",
        "TLS 1.3：更安全、更快（1-RTT 握手）",
        "证书：X.509 格式，CA 签发"
      ]
    },
    {
      "type": "codeBlock",
      "title": "TLS 1.3 握手流程",
      "language": "text",
      "code": "TLS 1.3 握手 (1-RTT)\n\nClient                                           Server\n   │                                                │\n   │  ClientHello                                   │\n   │  + key_share                                   │\n   │  + supported_versions                          │\n   │─────────────────────────────────────────────►  │\n   │                                                │\n   │                          ServerHello           │\n   │                          + key_share           │\n   │                          {EncryptedExtensions} │\n   │                          {Certificate}         │\n   │                          {CertificateVerify}   │\n   │                          {Finished}            │\n   │  ◄─────────────────────────────────────────────│\n   │                                                │\n   │  {Finished}                                    │\n   │─────────────────────────────────────────────►  │\n   │                                                │\n   │  ──────── Application Data ────────►           │\n   │  ◄─────── Application Data ─────────           │\n\n密码套件 (TLS 1.3):\n- TLS_AES_256_GCM_SHA384\n- TLS_CHACHA20_POLY1305_SHA256"
    },
    {
      "type": "codeBlock",
      "title": "Nginx TLS 配置",
      "language": "nginx",
      "code": "server {\n    listen 443 ssl http2;\n    server_name example.com;\n    \n    # 证书\n    ssl_certificate /etc/ssl/certs/example.com.pem;\n    ssl_certificate_key /etc/ssl/private/example.com.key;\n    \n    # TLS 版本（只允许 1.2 和 1.3）\n    ssl_protocols TLSv1.2 TLSv1.3;\n    \n    # 密码套件\n    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384;\n    ssl_prefer_server_ciphers off;\n    \n    # OCSP Stapling\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    ssl_trusted_certificate /etc/ssl/certs/ca-bundle.crt;\n    \n    # HSTS\n    add_header Strict-Transport-Security \"max-age=63072000\" always;\n    \n    # 会话复用\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 1d;\n    ssl_session_tickets off;\n}"
    },
    {
      "type": "codeBlock",
      "title": "Let's Encrypt 自动证书",
      "language": "bash",
      "code": "# 安装 certbot\nsudo apt install certbot python3-certbot-nginx\n\n# 申请证书\nsudo certbot --nginx -d example.com -d www.example.com\n\n# 自动续期（crontab）\n0 0 1 * * certbot renew --quiet\n\n# 手动续期\nsudo certbot renew\n\n# 查看证书信息\nopenssl x509 -in /etc/letsencrypt/live/example.com/fullchain.pem -text -noout"
    },
    {
      "type": "table",
      "title": "TLS 版本对比",
      "highlightFirst": true,
      "headers": ["版本", "状态", "握手", "说明"],
      "rows": [
        ["TLS 1.3", "推荐", "1-RTT", "2018年发布，最安全"],
        ["TLS 1.2", "可用", "2-RTT", "需正确配置"],
        ["TLS 1.1", "废弃", "2-RTT", "2021年废弃"],
        ["TLS 1.0", "废弃", "2-RTT", "2021年废弃"],
        ["SSL 3.0", "禁止", "-", "POODLE 漏洞"]
      ]
    },
    {
      "type": "list",
      "title": "配置检查",
      "style": "check",
      "items": [
        { "label": "禁用旧版本", "description": "只允许 TLS 1.2+" },
        { "label": "HSTS", "description": "强制 HTTPS 访问" },
        { "label": "OCSP Stapling", "description": "加速证书验证" },
        { "label": "证书透明度", "description": "CT Log 监控证书签发" }
      ]
    }
  ],
  "relatedTopics": ["证书", "HTTPS", "密钥交换"]
}
