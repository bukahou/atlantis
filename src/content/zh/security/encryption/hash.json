{
  "meta": {
    "title": "哈希算法",
    "description": "SHA 系列、密码哈希与 HMAC",
    "order": 3,
    "tags": ["哈希", "SHA", "密码存储"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "哈希：任意长度输入 → 固定长度输出",
        "特性：单向、抗碰撞、雪崩效应",
        "用途：完整性校验、密码存储、数字签名",
        "密码哈希：专门设计的慢速哈希（Argon2、bcrypt）"
      ]
    },
    {
      "type": "cards",
      "title": "哈希算法分类",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "通用哈希",
          "badge": "完整性",
          "badgeColor": "blue",
          "points": [
            "SHA-256/384/512",
            "BLAKE3",
            "快速计算"
          ]
        },
        {
          "title": "密码哈希",
          "badge": "密码存储",
          "badgeColor": "green",
          "points": [
            "Argon2id",
            "bcrypt/scrypt",
            "故意慢速"
          ]
        },
        {
          "title": "MAC",
          "badge": "认证",
          "badgeColor": "purple",
          "points": [
            "HMAC-SHA256",
            "消息认证",
            "防篡改"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "密码哈希存储",
      "language": "typescript",
      "code": "import argon2 from 'argon2';\n\n// Argon2id 配置（OWASP 推荐）\nconst ARGON2_OPTIONS = {\n  type: argon2.argon2id,\n  memoryCost: 2 ** 16,  // 64 MB\n  timeCost: 3,          // 3 次迭代\n  parallelism: 1,\n};\n\n// 密码哈希\nasync function hashPassword(password: string): Promise<string> {\n  return argon2.hash(password, ARGON2_OPTIONS);\n}\n\n// 验证密码\nasync function verifyPassword(hash: string, password: string): Promise<boolean> {\n  try {\n    return await argon2.verify(hash, password);\n  } catch {\n    return false;\n  }\n}\n\n// 示例\nconst hash = await hashPassword('mySecurePassword');\n// $argon2id$v=19$m=65536,t=3,p=1$salt$hash\n\nconst isValid = await verifyPassword(hash, 'mySecurePassword');\n// true"
    },
    {
      "type": "codeBlock",
      "title": "HMAC 消息认证",
      "language": "go",
      "code": "import (\n    \"crypto/hmac\"\n    \"crypto/sha256\"\n    \"encoding/hex\"\n)\n\n// 生成 HMAC\nfunc GenerateHMAC(key, message []byte) string {\n    h := hmac.New(sha256.New, key)\n    h.Write(message)\n    return hex.EncodeToString(h.Sum(nil))\n}\n\n// 验证 HMAC（常量时间比较，防时序攻击）\nfunc VerifyHMAC(key, message []byte, expectedMAC string) bool {\n    expectedBytes, _ := hex.DecodeString(expectedMAC)\n    actualMAC := hmac.New(sha256.New, key)\n    actualMAC.Write(message)\n    return hmac.Equal(actualMAC.Sum(nil), expectedBytes)\n}\n\n// Webhook 签名验证示例\nfunc VerifyWebhook(secret, payload []byte, signature string) bool {\n    expected := \"sha256=\" + GenerateHMAC(secret, payload)\n    return hmac.Equal([]byte(expected), []byte(signature))\n}"
    },
    {
      "type": "table",
      "title": "算法选择",
      "highlightFirst": true,
      "headers": ["用途", "推荐", "不推荐"],
      "rows": [
        ["密码存储", "Argon2id", "MD5, SHA1, SHA256"],
        ["文件校验", "SHA-256, BLAKE3", "MD5"],
        ["消息认证", "HMAC-SHA256", "自制方案"],
        ["数据指纹", "SHA-256", "CRC32"],
        ["高性能哈希", "BLAKE3", "SHA-1"]
      ]
    },
    {
      "type": "list",
      "title": "安全实践",
      "style": "check",
      "items": [
        { "label": "密码用专用哈希", "description": "Argon2id > bcrypt > scrypt > PBKDF2" },
        { "label": "自动加盐", "description": "Argon2/bcrypt 自动处理，无需手动" },
        { "label": "常量时间比较", "description": "验证时使用 hmac.Equal 防时序攻击" },
        { "label": "禁用 MD5/SHA1", "description": "已被破解，仅用于遗留兼容" }
      ]
    }
  ],
  "relatedTopics": ["密码安全", "对称加密", "数字签名"]
}
