{
  "meta": {
    "title": "对称加密",
    "description": "AES、ChaCha20 与加密模式",
    "order": 1,
    "tags": ["加密", "AES", "对称加密"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "对称加密：加密和解密使用相同的密钥",
        "优点：速度快，适合大量数据加密",
        "挑战：密钥分发和管理",
        "常用算法：AES-256-GCM、ChaCha20-Poly1305"
      ]
    },
    {
      "type": "cards",
      "title": "常用算法",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "AES",
          "badge": "标准",
          "badgeColor": "blue",
          "points": [
            "NIST 标准",
            "128/192/256 位密钥",
            "硬件加速支持"
          ]
        },
        {
          "title": "ChaCha20",
          "badge": "现代",
          "badgeColor": "green",
          "points": [
            "软件性能优秀",
            "移动设备友好",
            "TLS 1.3 支持"
          ]
        },
        {
          "title": "SM4",
          "badge": "国密",
          "badgeColor": "purple",
          "points": [
            "中国国家标准",
            "128 位密钥",
            "合规要求"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "AES-256-GCM 加密",
      "language": "go",
      "code": "import (\n    \"crypto/aes\"\n    \"crypto/cipher\"\n    \"crypto/rand\"\n)\n\n// AES-256-GCM 加密\nfunc EncryptAESGCM(key, plaintext []byte) ([]byte, error) {\n    block, err := aes.NewCipher(key) // key 必须 32 字节 (256位)\n    if err != nil {\n        return nil, err\n    }\n    \n    aesGCM, err := cipher.NewGCM(block)\n    if err != nil {\n        return nil, err\n    }\n    \n    // 生成随机 nonce（12 字节）\n    nonce := make([]byte, aesGCM.NonceSize())\n    if _, err := rand.Read(nonce); err != nil {\n        return nil, err\n    }\n    \n    // 加密（GCM 自带认证）\n    ciphertext := aesGCM.Seal(nonce, nonce, plaintext, nil)\n    return ciphertext, nil // nonce + ciphertext + tag\n}\n\n// 解密\nfunc DecryptAESGCM(key, ciphertext []byte) ([]byte, error) {\n    block, _ := aes.NewCipher(key)\n    aesGCM, _ := cipher.NewGCM(block)\n    \n    nonceSize := aesGCM.NonceSize()\n    nonce, ciphertext := ciphertext[:nonceSize], ciphertext[nonceSize:]\n    \n    return aesGCM.Open(nil, nonce, ciphertext, nil)\n}"
    },
    {
      "type": "table",
      "title": "加密模式对比",
      "highlightFirst": true,
      "headers": ["模式", "认证", "并行", "推荐度"],
      "rows": [
        ["GCM", "是 (AEAD)", "加密并行", "推荐"],
        ["CTR", "否", "完全并行", "需配合 HMAC"],
        ["CBC", "否", "加密串行", "遗留系统"],
        ["ECB", "否", "完全并行", "禁止使用"]
      ]
    },
    {
      "type": "codeBlock",
      "title": "密钥派生",
      "language": "typescript",
      "code": "import { scrypt, randomBytes } from 'crypto';\n\n// 从密码派生加密密钥\nasync function deriveKey(password: string, salt: Buffer): Promise<Buffer> {\n  return new Promise((resolve, reject) => {\n    scrypt(password, salt, 32, { N: 2 ** 17, r: 8, p: 1 }, (err, key) => {\n      if (err) reject(err);\n      else resolve(key);\n    });\n  });\n}\n\n// 加密数据（带密钥派生）\nasync function encryptWithPassword(password: string, data: Buffer) {\n  const salt = randomBytes(16);\n  const key = await deriveKey(password, salt);\n  const encrypted = await encryptAESGCM(key, data);\n  \n  // 返回 salt + encrypted\n  return Buffer.concat([salt, encrypted]);\n}"
    },
    {
      "type": "list",
      "title": "安全实践",
      "style": "check",
      "items": [
        { "label": "使用 AEAD 模式", "description": "优先 AES-GCM 或 ChaCha20-Poly1305" },
        { "label": "密钥足够长", "description": "AES 至少 256 位" },
        { "label": "Nonce 不重用", "description": "每次加密使用随机或递增 Nonce" },
        { "label": "安全密钥存储", "description": "使用 KMS 或 HSM 管理密钥" }
      ]
    }
  ],
  "relatedTopics": ["非对称加密", "密钥管理", "TLS"]
}
