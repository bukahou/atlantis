{
  "meta": {
    "title": "Docker 基础",
    "description": "Docker 核心概念、安装配置与基本操作",
    "order": 1,
    "tags": ["Docker", "容器", "DevOps"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "Docker 将应用与环境打包为可移植容器",
        "镜像是只读模板，容器是运行实例",
        "Dockerfile 定义镜像构建步骤",
        "Docker Compose 编排多容器应用"
      ]
    },
    {
      "type": "text",
      "title": "什么是 Docker",
      "content": "Docker 是一个开源的容器化平台，可以将应用程序及其依赖打包到一个轻量级、可移植的容器中。容器在任何支持 Docker 的环境中都能一致运行，解决了\"在我机器上能运行\"的问题。"
    },
    {
      "type": "codeBlock",
      "title": "Dockerfile 示例",
      "language": "dockerfile",
      "code": "# 基础镜像\nFROM node:18-alpine\n\n# 设置工作目录\nWORKDIR /app\n\n# 复制依赖文件\nCOPY package*.json ./\n\n# 安装依赖\nRUN npm ci --only=production\n\n# 复制源代码\nCOPY . .\n\n# 暴露端口\nEXPOSE 3000\n\n# 启动命令\nCMD [\"node\", \"server.js\"]"
    },
    {
      "type": "table",
      "title": "Dockerfile 常用指令",
      "highlightFirst": true,
      "headers": ["指令", "说明", "示例"],
      "rows": [
        ["FROM", "基础镜像", "FROM node:18-alpine"],
        ["WORKDIR", "工作目录", "WORKDIR /app"],
        ["COPY", "复制文件", "COPY . ."],
        ["RUN", "执行命令（构建时）", "RUN npm install"],
        ["CMD", "启动命令", "CMD [\"npm\", \"start\"]"],
        ["ENV", "环境变量", "ENV NODE_ENV=production"],
        ["EXPOSE", "声明端口", "EXPOSE 3000"],
        ["VOLUME", "挂载点", "VOLUME /data"]
      ]
    },
    {
      "type": "cards",
      "title": "常用操作",
      "layout": "grid",
      "columns": 2,
      "items": [
        {
          "title": "镜像操作",
          "badge": "Image",
          "badgeColor": "blue",
          "points": [
            "docker build -t app:v1 . - 构建",
            "docker images - 列出镜像",
            "docker pull nginx - 拉取镜像",
            "docker push user/app - 推送镜像"
          ]
        },
        {
          "title": "容器操作",
          "badge": "Container",
          "badgeColor": "green",
          "points": [
            "docker run -d -p 80:80 nginx - 运行",
            "docker ps - 查看运行中容器",
            "docker stop/start ID - 停止/启动",
            "docker rm ID - 删除容器"
          ]
        },
        {
          "title": "调试操作",
          "badge": "Debug",
          "badgeColor": "amber",
          "points": [
            "docker logs -f ID - 查看日志",
            "docker exec -it ID bash - 进入容器",
            "docker inspect ID - 查看详情",
            "docker stats - 资源使用"
          ]
        },
        {
          "title": "网络/存储",
          "badge": "Storage",
          "badgeColor": "purple",
          "points": [
            "docker network ls - 网络列表",
            "docker volume create - 创建卷",
            "-v host:container - 挂载目录",
            "--network=host - 主机网络"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "Docker Compose 示例",
      "language": "yaml",
      "code": "version: '3.8'\n\nservices:\n  web:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - DB_HOST=db\n    depends_on:\n      - db\n      - redis\n\n  db:\n    image: postgres:14\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    environment:\n      - POSTGRES_PASSWORD=secret\n\n  redis:\n    image: redis:alpine\n\nvolumes:\n  postgres_data:"
    },
    {
      "type": "flow",
      "title": "镜像分层结构",
      "subtitle": "每条指令创建一个只读层",
      "direction": "vertical",
      "steps": [
        { "label": "FROM", "description": "基础镜像层", "color": "bg-gray-500" },
        { "label": "RUN apt-get", "description": "系统依赖层", "color": "bg-blue-500" },
        { "label": "COPY package.json", "description": "依赖定义层", "color": "bg-purple-500" },
        { "label": "RUN npm install", "description": "依赖安装层", "color": "bg-cyan-500" },
        { "label": "COPY .", "description": "源代码层", "color": "bg-green-500" }
      ]
    },
    {
      "type": "list",
      "title": "最佳实践",
      "style": "check",
      "items": [
        { "label": "使用多阶段构建", "description": "减小最终镜像体积，分离构建和运行环境" },
        { "label": "优化层缓存", "description": "将不常变化的指令放在前面" },
        { "label": "使用 .dockerignore", "description": "排除不需要的文件" },
        { "label": "非 root 用户运行", "description": "USER 指令切换用户提高安全性" },
        { "label": "使用轻量基础镜像", "description": "alpine 比完整发行版小得多" },
        { "label": "健康检查", "description": "HEALTHCHECK 指令监控容器健康" }
      ]
    }
  ],
  "relatedTopics": ["Kubernetes", "CI/CD", "微服务"]
}
