{
  "meta": {
    "title": "MongoDB",
    "description": "MongoDB 文档数据库、查询操作与聚合管道",
    "order": 1,
    "tags": ["MongoDB", "NoSQL", "文档数据库"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "MongoDB 是面向文档的 NoSQL 数据库",
        "BSON 格式存储，灵活 Schema",
        "强大的聚合框架",
        "副本集高可用，分片水平扩展"
      ]
    },
    {
      "type": "codeBlock",
      "title": "CRUD 操作",
      "language": "javascript",
      "code": "// 插入文档\ndb.users.insertOne({\n  name: \"Alice\",\n  email: \"alice@example.com\",\n  tags: [\"developer\", \"golang\"]\n});\n\n// 查询\ndb.users.find({ age: { $gt: 25 } });\ndb.users.findOne({ email: \"alice@example.com\" });\n\n// 更新\ndb.users.updateOne(\n  { email: \"alice@example.com\" },\n  { $set: { age: 29 }, $push: { tags: \"k8s\" } }\n);\n\n// 删除\ndb.users.deleteOne({ email: \"alice@example.com\" });"
    },
    {
      "type": "cards",
      "title": "查询操作符",
      "layout": "grid",
      "columns": 2,
      "items": [
        {
          "title": "比较操作符",
          "badge": "Compare",
          "badgeColor": "blue",
          "points": [
            "$eq, $ne 等于/不等于",
            "$gt, $gte 大于",
            "$lt, $lte 小于",
            "$in, $nin 列表匹配"
          ]
        },
        {
          "title": "逻辑操作符",
          "badge": "Logic",
          "badgeColor": "green",
          "points": [
            "$and 与条件",
            "$or 或条件",
            "$not 非条件",
            "$nor 都不满足"
          ]
        },
        {
          "title": "数组操作符",
          "badge": "Array",
          "badgeColor": "purple",
          "points": [
            "$all 包含所有",
            "$size 数组长度",
            "$elemMatch 元素匹配"
          ]
        },
        {
          "title": "元素操作符",
          "badge": "Element",
          "badgeColor": "amber",
          "points": [
            "$exists 字段存在",
            "$type 类型匹配"
          ]
        }
      ]
    },
    {
      "type": "table",
      "title": "索引类型",
      "highlightFirst": true,
      "headers": ["索引类型", "创建方式", "用途"],
      "rows": [
        ["单字段", "{ email: 1 }", "普通查询"],
        ["复合", "{ name: 1, age: -1 }", "多字段查询"],
        ["唯一", "{ unique: true }", "去重约束"],
        ["文本", "{ type: \"text\" }", "全文搜索"],
        ["TTL", "{ expireAfterSeconds }", "自动过期"],
        ["地理空间", "{ type: \"2dsphere\" }", "位置查询"]
      ]
    },
    {
      "type": "flow",
      "title": "聚合管道",
      "direction": "horizontal",
      "steps": [
        { "label": "$match", "description": "过滤文档", "color": "bg-blue-500" },
        { "label": "$group", "description": "分组聚合", "color": "bg-purple-500" },
        { "label": "$sort", "description": "排序", "color": "bg-cyan-500" },
        { "label": "$project", "description": "投影", "color": "bg-green-500" }
      ]
    },
    {
      "type": "codeBlock",
      "title": "聚合示例",
      "language": "javascript",
      "code": "db.orders.aggregate([\n  { $match: { status: \"completed\" } },\n  { $group: {\n      _id: \"$userId\",\n      totalAmount: { $sum: \"$amount\" },\n      orderCount: { $sum: 1 }\n  }},\n  { $sort: { totalAmount: -1 } },\n  { $limit: 10 }\n]);\n\n// Lookup 关联查询\ndb.orders.aggregate([\n  { $lookup: {\n      from: \"users\",\n      localField: \"userId\",\n      foreignField: \"_id\",\n      as: \"user\"\n  }},\n  { $unwind: \"$user\" }\n]);"
    },
    {
      "type": "comparison",
      "title": "高可用架构",
      "columns": [
        {
          "title": "副本集",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            { "label": "组成", "description": "Primary + Secondary + Arbiter" },
            { "label": "特点", "description": "自动故障转移" },
            { "label": "读取", "description": "可配置读偏好" }
          ]
        },
        {
          "title": "分片集群",
          "color": "from-green-500 to-emerald-500",
          "items": [
            { "label": "组成", "description": "mongos + config + shard" },
            { "label": "特点", "description": "水平扩展" },
            { "label": "策略", "description": "范围/哈希/区域分片" }
          ]
        }
      ]
    },
    {
      "type": "list",
      "title": "最佳实践",
      "style": "check",
      "items": [
        { "label": "合理建模", "description": "嵌入 vs 引用，避免过深嵌套" },
        { "label": "索引优化", "description": "覆盖索引，避免全表扫描" },
        { "label": "批量操作", "description": "insertMany/bulkWrite" },
        { "label": "连接池", "description": "复用连接，设置合理大小" }
      ]
    }
  ],
  "relatedTopics": ["Redis", "Elasticsearch", "聚合查询"]
}
