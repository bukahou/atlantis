{
  "meta": {
    "title": "数据库范式",
    "description": "数据库范式理论、反范式设计与数据建模",
    "order": 1,
    "tags": ["数据库设计", "范式", "建模"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "范式是设计关系数据库消除冗余的指导原则",
        "从低到高：1NF -> 2NF -> 3NF -> BCNF",
        "高范式减少冗余，但可能影响查询性能",
        "实际设计需平衡规范化与性能"
      ]
    },
    {
      "type": "flow",
      "title": "范式层级",
      "direction": "horizontal",
      "steps": [
        { "label": "1NF", "description": "原子性", "color": "bg-blue-500" },
        { "label": "2NF", "description": "消除部分依赖", "color": "bg-cyan-500" },
        { "label": "3NF", "description": "消除传递依赖", "color": "bg-green-500" },
        { "label": "BCNF", "description": "消除主属性依赖", "color": "bg-purple-500" }
      ]
    },
    {
      "type": "cards",
      "title": "范式详解",
      "layout": "grid",
      "columns": 2,
      "items": [
        {
          "title": "第一范式 (1NF)",
          "badge": "原子性",
          "badgeColor": "blue",
          "points": [
            "每个属性不可再分",
            "不能存储数组/列表",
            "如：products 不能存 \"A,B,C\""
          ]
        },
        {
          "title": "第二范式 (2NF)",
          "badge": "完全依赖",
          "badgeColor": "green",
          "points": [
            "满足 1NF",
            "非主属性完全依赖主键",
            "消除部分依赖"
          ]
        },
        {
          "title": "第三范式 (3NF)",
          "badge": "直接依赖",
          "badgeColor": "amber",
          "points": [
            "满足 2NF",
            "非主属性不传递依赖主键",
            "消除传递依赖"
          ]
        },
        {
          "title": "BCNF",
          "badge": "决定因素",
          "badgeColor": "purple",
          "points": [
            "满足 3NF",
            "每个决定因素都是候选键",
            "更严格的 3NF"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "3NF 示例",
      "language": "sql",
      "code": "-- 违反 3NF (传递依赖)\n-- department_name 依赖 department_id\nCREATE TABLE employees_bad (\n    id INT PRIMARY KEY,\n    name VARCHAR(100),\n    department_id INT,\n    department_name VARCHAR(100)  -- 传递依赖\n);\n\n-- 符合 3NF\nCREATE TABLE departments (\n    id INT PRIMARY KEY,\n    name VARCHAR(100)\n);\n\nCREATE TABLE employees (\n    id INT PRIMARY KEY,\n    name VARCHAR(100),\n    department_id INT REFERENCES departments(id)\n);"
    },
    {
      "type": "comparison",
      "title": "范式 vs 反范式",
      "columns": [
        {
          "title": "规范化",
          "color": "from-blue-500 to-cyan-500",
          "items": [
            { "label": "优点", "description": "减少冗余、数据一致" },
            { "label": "缺点", "description": "多表 JOIN、查询复杂" },
            { "label": "适用", "description": "OLTP、写多读少" }
          ]
        },
        {
          "title": "反范式",
          "color": "from-green-500 to-emerald-500",
          "items": [
            { "label": "优点", "description": "查询快、减少 JOIN" },
            { "label": "缺点", "description": "数据冗余、更新复杂" },
            { "label": "适用", "description": "OLAP、读多写少" }
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "反范式技术",
      "language": "sql",
      "code": "-- 1. 冗余字段 (避免 JOIN)\nCREATE TABLE orders (\n    id INT PRIMARY KEY,\n    user_id INT,\n    user_name VARCHAR(100),  -- 冗余\n    total_amount DECIMAL(10,2)\n);\n\n-- 2. 预计算字段\nCREATE TABLE products (\n    id INT PRIMARY KEY,\n    name VARCHAR(100),\n    review_count INT DEFAULT 0,\n    avg_rating DECIMAL(2,1) DEFAULT 0\n);\n\n-- 3. 汇总表\nCREATE TABLE daily_sales (\n    date DATE PRIMARY KEY,\n    total_orders INT,\n    total_revenue DECIMAL(12,2)\n);"
    },
    {
      "type": "table",
      "title": "实体关系",
      "highlightFirst": true,
      "headers": ["关系类型", "实现方式", "示例"],
      "rows": [
        ["一对一", "主键关联/同表", "用户-详情"],
        ["一对多", "外键关联", "分类-商品"],
        ["多对多", "中间表", "商品-标签"],
        ["自关联", "自引用外键", "员工-上级"]
      ]
    },
    {
      "type": "list",
      "title": "设计原则",
      "style": "check",
      "items": [
        { "label": "从高范式开始", "description": "根据性能需求适当反范式" },
        { "label": "命名规范", "description": "表名复数，外键 table_id" },
        { "label": "主键设计", "description": "自增 ID 或分布式 ID" },
        { "label": "记录决策", "description": "文档化反范式理由" }
      ]
    }
  ],
  "relatedTopics": ["索引设计", "分库分表", "数据建模"]
}
