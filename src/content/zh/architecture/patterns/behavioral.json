{
  "meta": {
    "title": "行为型模式",
    "description": "策略、观察者、责任链等行为交互模式",
    "order": 3,
    "tags": ["设计模式", "GoF", "对象交互"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "行为型模式关注对象间的职责分配和通信",
        "通过组合实现灵活的行为变化",
        "11种经典模式：策略、观察者、责任链、命令、状态等"
      ]
    },
    {
      "type": "cards",
      "title": "常用模式",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "策略模式",
          "badge": "Strategy",
          "badgeColor": "blue",
          "points": [
            "算法族封装",
            "运行时切换",
            "消除 if-else"
          ]
        },
        {
          "title": "观察者",
          "badge": "Observer",
          "badgeColor": "green",
          "points": [
            "一对多依赖",
            "事件通知",
            "发布-订阅"
          ]
        },
        {
          "title": "责任链",
          "badge": "Chain",
          "badgeColor": "purple",
          "points": [
            "请求传递",
            "解耦发送者",
            "中间件模式"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "策略模式 - TypeScript 实现",
      "language": "typescript",
      "code": "// 策略接口\ninterface PaymentStrategy {\n  pay(amount: number): void;\n}\n\n// 具体策略\nclass AlipayStrategy implements PaymentStrategy {\n  pay(amount: number) {\n    console.log(`支付宝支付 ¥${amount}`);\n  }\n}\n\nclass WechatPayStrategy implements PaymentStrategy {\n  pay(amount: number) {\n    console.log(`微信支付 ¥${amount}`);\n  }\n}\n\n// 上下文\nclass PaymentContext {\n  constructor(private strategy: PaymentStrategy) {}\n  \n  setStrategy(strategy: PaymentStrategy) {\n    this.strategy = strategy;\n  }\n  \n  executePayment(amount: number) {\n    this.strategy.pay(amount);\n  }\n}\n\n// 使用\nconst payment = new PaymentContext(new AlipayStrategy());\npayment.executePayment(100); // 支付宝支付\npayment.setStrategy(new WechatPayStrategy());\npayment.executePayment(200); // 微信支付"
    },
    {
      "type": "codeBlock",
      "title": "观察者模式 - Go 实现",
      "language": "go",
      "code": "// 观察者接口\ntype Observer interface {\n    Update(event string, data interface{})\n}\n\n// 主题\ntype EventEmitter struct {\n    observers map[string][]Observer\n    mu        sync.RWMutex\n}\n\nfunc (e *EventEmitter) Subscribe(event string, observer Observer) {\n    e.mu.Lock()\n    defer e.mu.Unlock()\n    e.observers[event] = append(e.observers[event], observer)\n}\n\nfunc (e *EventEmitter) Emit(event string, data interface{}) {\n    e.mu.RLock()\n    defer e.mu.RUnlock()\n    for _, observer := range e.observers[event] {\n        go observer.Update(event, data)\n    }\n}\n\n// 具体观察者\ntype Logger struct{}\n\nfunc (l *Logger) Update(event string, data interface{}) {\n    log.Printf(\"Event: %s, Data: %v\", event, data)\n}\n\n// 使用\nemitter := NewEventEmitter()\nemitter.Subscribe(\"user.created\", &Logger{})\nemitter.Emit(\"user.created\", user)"
    },
    {
      "type": "codeBlock",
      "title": "责任链模式 - 中间件实现",
      "language": "go",
      "code": "// Handler 处理器接口\ntype Handler interface {\n    Handle(ctx *Context) error\n    SetNext(handler Handler)\n}\n\n// 基础处理器\ntype BaseHandler struct {\n    next Handler\n}\n\nfunc (b *BaseHandler) SetNext(handler Handler) {\n    b.next = handler\n}\n\nfunc (b *BaseHandler) HandleNext(ctx *Context) error {\n    if b.next != nil {\n        return b.next.Handle(ctx)\n    }\n    return nil\n}\n\n// 认证中间件\ntype AuthHandler struct {\n    BaseHandler\n}\n\nfunc (a *AuthHandler) Handle(ctx *Context) error {\n    if ctx.Token == \"\" {\n        return errors.New(\"unauthorized\")\n    }\n    return a.HandleNext(ctx)\n}\n\n// 日志中间件\ntype LogHandler struct {\n    BaseHandler\n}\n\nfunc (l *LogHandler) Handle(ctx *Context) error {\n    log.Printf(\"Request: %s\", ctx.Path)\n    err := l.HandleNext(ctx)\n    log.Printf(\"Response: %v\", err)\n    return err\n}\n\n// 组装链\nauth := &AuthHandler{}\nlogger := &LogHandler{}\nlogger.SetNext(auth)"
    },
    {
      "type": "table",
      "title": "行为型模式总结",
      "highlightFirst": true,
      "headers": ["模式", "意图", "典型应用"],
      "rows": [
        ["策略", "算法可替换", "支付方式、排序算法"],
        ["观察者", "事件通知", "事件系统、响应式"],
        ["责任链", "请求传递", "中间件、过滤器"],
        ["命令", "请求封装", "撤销/重做、任务队列"],
        ["状态", "状态驱动行为", "工作流、游戏状态"],
        ["模板方法", "骨架算法", "框架钩子"]
      ]
    },
    {
      "type": "list",
      "title": "现代应用",
      "style": "check",
      "items": [
        { "label": "策略 + 依赖注入", "description": "Spring/Nest.js 中的策略选择" },
        { "label": "观察者 → 响应式", "description": "RxJS、Vue 响应式系统" },
        { "label": "责任链 → 中间件", "description": "Koa、Gin、Express 中间件" },
        { "label": "命令 → CQRS", "description": "命令查询职责分离" }
      ]
    }
  ],
  "relatedTopics": ["中间件", "事件驱动", "响应式编程"]
}
