{
  "meta": {
    "title": "冗余设计",
    "description": "消除单点故障的策略与实践",
    "order": 1,
    "tags": ["高可用", "冗余", "SPOF"]
  },
  "sections": [
    {
      "type": "keyPoints",
      "title": "核心概念",
      "items": [
        "SPOF (Single Point of Failure)：单点故障",
        "冗余：通过备份消除单点故障",
        "N+1/N+M：容错设计模式",
        "无状态服务：水平扩展的基础"
      ]
    },
    {
      "type": "cards",
      "title": "冗余类型",
      "layout": "grid",
      "columns": 3,
      "items": [
        {
          "title": "计算冗余",
          "badge": "服务层",
          "badgeColor": "blue",
          "points": [
            "多实例部署",
            "负载均衡",
            "无状态设计"
          ]
        },
        {
          "title": "存储冗余",
          "badge": "数据层",
          "badgeColor": "green",
          "points": [
            "主从复制",
            "多副本存储",
            "RAID 阵列"
          ]
        },
        {
          "title": "网络冗余",
          "badge": "基础设施",
          "badgeColor": "purple",
          "points": [
            "多链路接入",
            "跨可用区",
            "DNS 故障转移"
          ]
        }
      ]
    },
    {
      "type": "codeBlock",
      "title": "无状态服务设计",
      "language": "go",
      "code": "// 有状态服务（不推荐）\ntype StatefulService struct {\n    sessions map[string]*Session  // 本地存储会话\n}\n\n// 无状态服务（推荐）\ntype StatelessService struct {\n    sessionStore SessionStore  // 外部存储（Redis）\n    config       *Config       // 只读配置\n}\n\nfunc (s *StatelessService) HandleRequest(r *Request) (*Response, error) {\n    // 从请求获取状态标识\n    sessionID := r.Header.Get(\"X-Session-ID\")\n    \n    // 从外部存储获取状态\n    session, err := s.sessionStore.Get(sessionID)\n    if err != nil {\n        return nil, err\n    }\n    \n    // 处理请求...\n    \n    // 更新状态到外部存储\n    return response, s.sessionStore.Set(session)\n}\n\n// 好处：\n// 1. 任意实例可处理任意请求\n// 2. 水平扩展简单\n// 3. 实例故障不丢失状态"
    },
    {
      "type": "codeBlock",
      "title": "数据库主从复制",
      "language": "yaml",
      "code": "# MySQL 主从配置\nmaster:\n  server-id: 1\n  log-bin: mysql-bin\n  binlog-format: ROW\n  sync-binlog: 1  # 每次事务同步 binlog\n\nslave:\n  server-id: 2\n  relay-log: mysql-relay\n  read-only: true\n  replica-parallel-workers: 4  # 并行复制\n\n# 半同步复制（提高一致性）\nmaster:\n  rpl_semi_sync_master_enabled: ON\n  rpl_semi_sync_master_timeout: 1000  # 1秒超时\n\n# 读写分离\nread:\n  - slave1:3306\n  - slave2:3306\nwrite:\n  - master:3306"
    },
    {
      "type": "table",
      "title": "冗余模式对比",
      "highlightFirst": true,
      "headers": ["模式", "描述", "成本", "恢复时间"],
      "rows": [
        ["Active-Passive", "主备模式，备机待命", "2x", "秒~分钟"],
        ["Active-Active", "双活，同时服务", "2x+", "毫秒级"],
        ["N+1", "N台服务+1台备用", "N+1", "秒级"],
        ["N+M", "更多冗余，更高可用", "N+M", "秒级"]
      ]
    },
    {
      "type": "list",
      "title": "检查清单",
      "style": "check",
      "items": [
        { "label": "识别所有 SPOF", "description": "数据库、缓存、消息队列、外部服务" },
        { "label": "服务无状态化", "description": "状态外移到 Redis/数据库" },
        { "label": "多可用区部署", "description": "跨机房/可用区分布" },
        { "label": "定期故障演练", "description": "Chaos Engineering 验证冗余" }
      ]
    }
  ],
  "relatedTopics": ["负载均衡", "故障转移", "Chaos Engineering"]
}
